import { __decorate } from "tslib";
import { Component, Input, Output, ChangeDetectionStrategy, EventEmitter } from '@angular/core';
import { Subscription } from 'rxjs';
import { map } from 'rxjs/operators';
import { NgProgress } from './ng-progress.service';
import { NgProgressRef } from './ng-progress-ref';
let NgProgressComponent = class NgProgressComponent {
    constructor(_ngProgress) {
        this._ngProgress = _ngProgress;
        this._started = Subscription.EMPTY;
        this._completed = Subscription.EMPTY;
        /** Creates a new instance if id is not already exists */
        this.id = 'root';
        /** Initializes inputs from the global config */
        this.min = this._ngProgress.config.min;
        this.max = this._ngProgress.config.max;
        this.ease = this._ngProgress.config.ease;
        this.color = this._ngProgress.config.color;
        this.speed = this._ngProgress.config.speed;
        this.thick = this._ngProgress.config.thick;
        this.fixed = this._ngProgress.config.fixed;
        this.meteor = this._ngProgress.config.meteor;
        this.spinner = this._ngProgress.config.spinner;
        this.trickleSpeed = this._ngProgress.config.trickleSpeed;
        this.debounceTime = this._ngProgress.config.debounceTime;
        this.trickleFunc = this._ngProgress.config.trickleFunc;
        this.spinnerPosition = this._ngProgress.config.spinnerPosition;
        this.direction = this._ngProgress.config.direction;
        this.started = new EventEmitter();
        this.completed = new EventEmitter();
    }
    get isStarted() {
        return this.progressRef.isStarted;
    }
    ngOnChanges() {
        if (this.progressRef instanceof NgProgressRef) {
            // Update progress bar config when inputs change
            this.progressRef.setConfig({
                max: (this.max > 0 && this.max <= 100) ? this.max : 100,
                min: (this.min < 100 && this.min >= 0) ? this.min : 0,
                speed: this.speed,
                trickleSpeed: this.trickleSpeed,
                trickleFunc: this.trickleFunc,
                debounceTime: this.debounceTime
            });
        }
    }
    ngOnInit() {
        // Get progress bar service instance
        this.progressRef = this._ngProgress.ref(this.id, {
            max: this.max,
            min: this.min,
            speed: this.speed,
            trickleSpeed: this.trickleSpeed,
            debounceTime: this.debounceTime
        });
        // Subscribe to progress state
        this.state$ = this.progressRef.state.pipe(map((state) => ({
            active: state.active,
            transform: `translate3d(${state.value}%,0,0)`
        })));
        // Subscribes to started and completed events on demand
        if (this.started.observers.length) {
            this._started = this.progressRef.started.subscribe(() => this.started.emit());
        }
        if (this.completed.observers.length) {
            this._completed = this.progressRef.completed.subscribe(() => this.completed.emit());
        }
    }
    ngOnDestroy() {
        this._started.unsubscribe();
        this._completed.unsubscribe();
        if (this.progressRef instanceof NgProgressRef) {
            this.progressRef.destroy();
        }
    }
    start() {
        this.progressRef.start();
    }
    complete() {
        this.progressRef.complete();
    }
    inc(n) {
        this.progressRef.inc(n);
    }
    set(n) {
        this.progressRef.set(n);
    }
};
NgProgressComponent.ctorParameters = () => [
    { type: NgProgress }
];
__decorate([
    Input()
], NgProgressComponent.prototype, "id", void 0);
__decorate([
    Input()
], NgProgressComponent.prototype, "min", void 0);
__decorate([
    Input()
], NgProgressComponent.prototype, "max", void 0);
__decorate([
    Input()
], NgProgressComponent.prototype, "ease", void 0);
__decorate([
    Input()
], NgProgressComponent.prototype, "color", void 0);
__decorate([
    Input()
], NgProgressComponent.prototype, "speed", void 0);
__decorate([
    Input()
], NgProgressComponent.prototype, "thick", void 0);
__decorate([
    Input()
], NgProgressComponent.prototype, "fixed", void 0);
__decorate([
    Input()
], NgProgressComponent.prototype, "meteor", void 0);
__decorate([
    Input()
], NgProgressComponent.prototype, "spinner", void 0);
__decorate([
    Input()
], NgProgressComponent.prototype, "trickleSpeed", void 0);
__decorate([
    Input()
], NgProgressComponent.prototype, "debounceTime", void 0);
__decorate([
    Input()
], NgProgressComponent.prototype, "trickleFunc", void 0);
__decorate([
    Input()
], NgProgressComponent.prototype, "spinnerPosition", void 0);
__decorate([
    Input()
], NgProgressComponent.prototype, "direction", void 0);
__decorate([
    Output()
], NgProgressComponent.prototype, "started", void 0);
__decorate([
    Output()
], NgProgressComponent.prototype, "completed", void 0);
NgProgressComponent = __decorate([
    Component({
        selector: 'ng-progress',
        host: {
            'role': 'progressbar',
            '[attr.spinnerPosition]': 'spinnerPosition',
            '[attr.dir]': 'direction',
            '[attr.thick]': 'thick',
            '[attr.fixed]': 'fixed'
        },
        template: `
    <ng-container *ngIf="state$ | async; let state">
      <div class="ng-progress-bar"
            [attr.active]="state.active"
            [style.transition]="'opacity ' + speed + 'ms ' + ease">
        <div class="ng-bar-placeholder">
          <div class="ng-bar"
                [style.transform]="state.transform"
                [style.backgroundColor]="color"
                [style.transition]="state.active ? 'all ' + speed + 'ms ' + ease : 'none'">
            <div *ngIf="meteor" class="ng-meteor" [style.boxShadow]="'0 0 10px '+ color + ', 0 0 5px ' + color"></div>
          </div>
        </div>
        <div *ngIf="spinner" class="ng-spinner">
          <div class="ng-spinner-icon"
                [style.borderTopColor]="color"
                [style.borderLeftColor]="color"></div>
        </div>
      </div>
    </ng-container>
  `,
        changeDetection: ChangeDetectionStrategy.OnPush,
        styles: [":host{z-index:999999;pointer-events:none}:host[fixed=true] .ng-progress-bar,:host[fixed=true] .ng-spinner{position:fixed}:host[fixed=true] .ng-spinner{top:15px}:host[fixed=true][spinnerPosition=left] .ng-spinner{left:15px}:host[fixed=true][spinnerPosition=right] .ng-spinner{right:15px}:host[thick=true] .ng-spinner-icon{width:24px;height:24px;border-width:3px}:host[thick=true] .ng-bar-placeholder{height:3px!important}:host[dir=\"ltr+\"] .ng-meteor,:host[dir=ltr-] .ng-meteor{transform:rotate(3deg)}:host[dir=\"ltr+\"][thick=true] .ng-meteor,:host[dir=ltr-][thick=true] .ng-meteor{transform:rotate(4deg)}:host[dir=\"ltr+\"] .ng-bar,:host[dir=\"rtl+\"] .ng-bar{margin-left:-100%}:host[dir=\"ltr+\"] .ng-meteor,:host[dir=\"rtl+\"] .ng-meteor{right:0}:host[dir=\"ltr+\"] .ng-meteor,:host[dir=rtl-] .ng-meteor{top:-3px}:host[dir=\"ltr+\"][thick=true] .ng-meteor,:host[dir=rtl-][thick=true] .ng-meteor{top:-4px}:host[dir=\"rtl+\"] .ng-meteor,:host[dir=ltr-] .ng-meteor{bottom:-3px}:host[dir=\"rtl+\"][thick=true] .ng-meteor,:host[dir=ltr-][thick=true] .ng-meteor{bottom:-4px}:host[dir=\"rtl+\"] .ng-bar-placeholder,:host[dir=ltr-] .ng-bar-placeholder{transform:rotate(180deg)}:host[dir=\"rtl+\"] .ng-spinner-icon,:host[dir=ltr-] .ng-spinner-icon{animation-direction:reverse}:host[dir=\"rtl+\"] .ng-meteor,:host[dir=rtl-] .ng-meteor{transform:rotate(-3deg)}:host[dir=\"rtl+\"][thick=true] .ng-meteor,:host[dir=rtl-][thick=true] .ng-meteor{transform:rotate(-4deg)}:host[spinnerPosition=left] .ng-spinner{left:10px}:host[spinnerPosition=right] .ng-spinner{right:10px}.ng-progress-bar{position:relative;z-index:999999;top:0;left:0;width:100%;zoom:1;opacity:0}.ng-progress-bar[active=true]{opacity:1;transition:none}.ng-bar-placeholder{position:absolute;height:2px;width:100%}.ng-bar{width:100%;height:100%;transform:translate(-100%,0,0)}.ng-meteor{display:block;position:absolute;width:100px;height:100%;opacity:1}.ng-spinner{position:absolute;display:block;z-index:1031;top:10px}.ng-spinner-icon{width:18px;height:18px;box-sizing:border-box;-webkit-animation:250ms linear infinite spinner-animation;animation:250ms linear infinite spinner-animation;border:2px solid transparent;border-radius:50%}@-webkit-keyframes spinner-animation{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}@keyframes spinner-animation{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}"]
    })
], NgProgressComponent);
export { NgProgressComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctcHJvZ3Jlc3MuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXByb2dyZXNzYmFyLyIsInNvdXJjZXMiOlsibGliL25nLXByb2dyZXNzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsTUFBTSxFQUlOLHVCQUF1QixFQUN2QixZQUFZLEVBRWIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFjLFlBQVksRUFBbUIsTUFBTSxNQUFNLENBQUM7QUFDakUsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFxQ2xELElBQWEsbUJBQW1CLEdBQWhDLE1BQWEsbUJBQW1CO0lBb0M5QixZQUFvQixXQUF1QjtRQUF2QixnQkFBVyxHQUFYLFdBQVcsQ0FBWTtRQWxDbkMsYUFBUSxHQUFxQixZQUFZLENBQUMsS0FBSyxDQUFDO1FBQ2hELGVBQVUsR0FBcUIsWUFBWSxDQUFDLEtBQUssQ0FBQztRQVExRCx5REFBeUQ7UUFDaEQsT0FBRSxHQUFHLE1BQU0sQ0FBQztRQUVyQixnREFBZ0Q7UUFDdkMsUUFBRyxHQUFXLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQztRQUMxQyxRQUFHLEdBQVcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDO1FBQzFDLFNBQUksR0FBVyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFDNUMsVUFBSyxHQUFXLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztRQUM5QyxVQUFLLEdBQVcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO1FBQzlD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K0M7QUFDOUM7SUFBUixLQUFLLEVBQUU7a0RBQWdEO0FBQy9DO0lBQVIsS0FBSyxFQUFFO2tEQUFnRDtBQUMvQztJQUFSLEtBQUssRUFBRTttREFBa0Q7QUFDakQ7SUFBUixLQUFLLEVBQUU7b0RBQW9EO0FBQ25EO0lBQVIsS0FBSyxFQUFFO3lEQUE2RDtBQUM1RDtJQUFSLEtBQUssRUFBRTt5REFBNkQ7QUFDNUQ7SUFBUixLQUFLLEVBQUU7d0RBQTBFO0FBQ3pFO0lBQVIsS0FBSyxFQUFFOzREQUE2RTtBQUM1RTtJQUFSLEtBQUssRUFBRTtzREFBa0Y7QUFDaEY7SUFBVCxNQUFNLEVBQUU7b0RBQThCO0FBQzdCO0lBQVQsTUFBTSxFQUFFO3NEQUFnQztBQTlCOUIsbUJBQW1CO0lBbEMvQixTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsYUFBYTtRQUN2QixJQUFJLEVBQUU7WUFDSixNQUFNLEVBQUUsYUFBYTtZQUNyQix3QkFBd0IsRUFBRSxpQkFBaUI7WUFDM0MsWUFBWSxFQUFFLFdBQVc7WUFDekIsY0FBYyxFQUFFLE9BQU87WUFDdkIsY0FBYyxFQUFFLE9BQU87U0FDeEI7UUFDRCxRQUFRLEVBQUU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBb0JUO1FBRUQsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07O0tBQ2hELENBQUM7R0FFVyxtQkFBbUIsQ0F1Ry9CO1NBdkdZLG1CQUFtQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgSW5wdXQsXG4gIE91dHB1dCxcbiAgT25DaGFuZ2VzLFxuICBPbkRlc3Ryb3ksXG4gIE9uSW5pdCxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIEV2ZW50RW1pdHRlcixcbiAgVmlld0VuY2Fwc3VsYXRpb25cbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24sIFN1YnNjcmlwdGlvbkxpa2V9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgTmdQcm9ncmVzcyB9IGZyb20gJy4vbmctcHJvZ3Jlc3Muc2VydmljZSc7XG5pbXBvcnQgeyBOZ1Byb2dyZXNzUmVmIH0gZnJvbSAnLi9uZy1wcm9ncmVzcy1yZWYnO1xuaW1wb3J0IHsgTmdQcm9ncmVzc1N0YXRlIH0gZnJvbSAnLi9uZy1wcm9ncmVzcy5pbnRlcmZhY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICduZy1wcm9ncmVzcycsXG4gIGhvc3Q6IHtcbiAgICAncm9sZSc6ICdwcm9ncmVzc2JhcicsXG4gICAgJ1thdHRyLnNwaW5uZXJQb3NpdGlvbl0nOiAnc3Bpbm5lclBvc2l0aW9uJyxcbiAgICAnW2F0dHIuZGlyXSc6ICdkaXJlY3Rpb24nLFxuICAgICdbYXR0ci50aGlja10nOiAndGhpY2snLFxuICAgICdbYXR0ci5maXhlZF0nOiAnZml4ZWQnXG4gIH0sXG4gIHRlbXBsYXRlOiBgXG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInN0YXRlJCB8IGFzeW5jOyBsZXQgc3RhdGVcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJuZy1wcm9ncmVzcy1iYXJcIlxuICAgICAgICAgICAgW2F0dHIuYWN0aXZlXT1cInN0YXRlLmFjdGl2ZVwiXG4gICAgICAgICAgICBbc3R5bGUudHJhbnNpdGlvbl09XCInb3BhY2l0eSAnICsgc3BlZWQgKyAnbXMgJyArIGVhc2VcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm5nLWJhci1wbGFjZWhvbGRlclwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJuZy1iYXJcIlxuICAgICAgICAgICAgICAgIFtzdHlsZS50cmFuc2Zvcm1dPVwic3RhdGUudHJhbnNmb3JtXCJcbiAgICAgICAgICAgICAgICBbc3R5bGUuYmFja2dyb3VuZENvbG9yXT1cImNvbG9yXCJcbiAgICAgICAgICAgICAgICBbc3R5bGUudHJhbnNpdGlvbl09XCJzdGF0ZS5hY3RpdmUgPyAnYWxsICcgKyBzcGVlZCArICdtcyAnICsgZWFzZSA6ICdub25lJ1wiPlxuICAgICAgICAgICAgPGRpdiAqbmdJZj1cIm1ldGVvclwiIGNsYXNzPVwibmctbWV0ZW9yXCIgW3N0eWxlLmJveFNoYWRvd109XCInMCAwIDEwcHggJysgY29sb3IgKyAnLCAwIDAgNXB4ICcgKyBjb2xvclwiPjwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiAqbmdJZj1cInNwaW5uZXJcIiBjbGFzcz1cIm5nLXNwaW5uZXJcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwibmctc3Bpbm5lci1pY29uXCJcbiAgICAgICAgICAgICAgICBbc3R5bGUuYm9yZGVyVG9wQ29sb3JdPVwiY29sb3JcIlxuICAgICAgICAgICAgICAgIFtzdHlsZS5ib3JkZXJMZWZ0Q29sb3JdPVwiY29sb3JcIj48L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L25nLWNvbnRhaW5lcj5cbiAgYCxcbiAgc3R5bGVVcmxzOiBbJy4vbmctcHJvZ3Jlc3MuY29tcG9uZW50LnNjc3MnXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcbn0pXG5cbmV4cG9ydCBjbGFzcyBOZ1Byb2dyZXNzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XG5cbiAgcHJpdmF0ZSBfc3RhcnRlZDogU3Vic2NyaXB0aW9uTGlrZSA9IFN1YnNjcmlwdGlvbi5FTVBUWTtcbiAgcHJpdmF0ZSBfY29tcGxldGVkOiBTdWJzY3JpcHRpb25MaWtlID0gU3Vic2NyaXB0aW9uLkVNUFRZO1xuXG4gIC8qKiBQcm9ncmVzcyBiYXIgd29ya2VyICovXG4gIHByb2dyZXNzUmVmOiBOZ1Byb2dyZXNzUmVmO1xuXG4gIC8qKiBTdHJlYW0gdGhhdCBlbWl0cyBwcm9ncmVzcyBzdGF0ZSAqL1xuICBzdGF0ZSQ6IE9ic2VydmFibGU8eyBhY3RpdmU6IGJvb2xlYW4sIHRyYW5zZm9ybTogc3RyaW5nIH0+O1xuXG4gIC8qKiBDcmVhdGVzIGEgbmV3IGluc3RhbmNlIGlmIGlkIGlzIG5vdCBhbHJlYWR5IGV4aXN0cyAqL1xuICBASW5wdXQoKSBpZCA9ICdyb290JztcblxuICAvKiogSW5pdGlhbGl6ZXMgaW5wdXRzIGZyb20gdGhlIGdsb2JhbCBjb25maWcgKi9cbiAgQElucHV0KCkgbWluOiBudW1iZXIgPSB0aGlzLl9uZ1Byb2dyZXNzLmNvbmZpZy5taW47XG4gIEBJbnB1dCgpIG1heDogbnVtYmVyID0gdGhpcy5fbmdQcm9ncmVzcy5jb25maWcubWF4O1xuICBASW5wdXQoKSBlYXNlOiBzdHJpbmcgPSB0aGlzLl9uZ1Byb2dyZXNzLmNvbmZpZy5lYXNlO1xuICBASW5wdXQoKSBjb2xvcjogc3RyaW5nID0gdGhpcy5fbmdQcm9ncmVzcy5jb25maWcuY29sb3I7XG4gIEBJbnB1dCgpIHNwZWVkOiBudW1iZXIgPSB0aGlzLl9uZ1Byb2dyZXNzLmNvbmZpZy5zcGVlZDtcbiAgQElucHV0KCkgdGhpY2s6IGJvb2xlYW4gPSB0aGlzLl9uZ1Byb2dyZXNzLmNvbmZpZy50aGljaztcbiAgQElucHV0KCkgZml4ZWQ6IGJvb2xlYW4gPSB0aGlzLl9uZ1Byb2dyZXNzLmNvbmZpZy5maXhlZDtcbiAgQElucHV0KCkgbWV0ZW9yOiBib29sZWFuID0gdGhpcy5fbmdQcm9ncmVzcy5jb25maWcubWV0ZW9yO1xuICBASW5wdXQoKSBzcGlubmVyOiBib29sZWFuID0gdGhpcy5fbmdQcm9ncmVzcy5jb25maWcuc3Bpbm5lcjtcbiAgQElucHV0KCkgdHJpY2tsZVNwZWVkOiBudW1iZXIgPSB0aGlzLl9uZ1Byb2dyZXNzLmNvbmZpZy50cmlja2xlU3BlZWQ7XG4gIEBJbnB1dCgpIGRlYm91bmNlVGltZTogbnVtYmVyID0gdGhpcy5fbmdQcm9ncmVzcy5jb25maWcuZGVib3VuY2VUaW1lO1xuICBASW5wdXQoKSB0cmlja2xlRnVuYzogKG46IG51bWJlcikgPT4gbnVtYmVyID0gdGhpcy5fbmdQcm9ncmVzcy5jb25maWcudHJpY2tsZUZ1bmM7XG4gIEBJbnB1dCgpIHNwaW5uZXJQb3NpdGlvbjogJ2xlZnQnIHwgJ3JpZ2h0JyA9IHRoaXMuX25nUHJvZ3Jlc3MuY29uZmlnLnNwaW5uZXJQb3NpdGlvbjtcbiAgQElucHV0KCkgZGlyZWN0aW9uOiAnbHRyKycgfCAnbHRyLScgfCAncnRsKycgfCAncnRsLScgPSB0aGlzLl9uZ1Byb2dyZXNzLmNvbmZpZy5kaXJlY3Rpb247XG4gIEBPdXRwdXQoKSBzdGFydGVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgY29tcGxldGVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIGdldCBpc1N0YXJ0ZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMucHJvZ3Jlc3NSZWYuaXNTdGFydGVkO1xuICB9XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBfbmdQcm9ncmVzczogTmdQcm9ncmVzcykge1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoKSB7XG4gICAgaWYgKHRoaXMucHJvZ3Jlc3NSZWYgaW5zdGFuY2VvZiBOZ1Byb2dyZXNzUmVmKSB7XG4gICAgICAvLyBVcGRhdGUgcHJvZ3Jlc3MgYmFyIGNvbmZpZyB3aGVuIGlucHV0cyBjaGFuZ2VcbiAgICAgIHRoaXMucHJvZ3Jlc3NSZWYuc2V0Q29uZmlnKHtcbiAgICAgICAgbWF4OiAodGhpcy5tYXggPiAwICYmIHRoaXMubWF4IDw9IDEwMCkgPyB0aGlzLm1heCA6IDEwMCxcbiAgICAgICAgbWluOiAodGhpcy5taW4gPCAxMDAgJiYgdGhpcy5taW4gPj0gMCkgPyB0aGlzLm1pbiA6IDAsXG4gICAgICAgIHNwZWVkOiB0aGlzLnNwZWVkLFxuICAgICAgICB0cmlja2xlU3BlZWQ6IHRoaXMudHJpY2tsZVNwZWVkLFxuICAgICAgICB0cmlja2xlRnVuYzogdGhpcy50cmlja2xlRnVuYyxcbiAgICAgICAgZGVib3VuY2VUaW1lOiB0aGlzLmRlYm91bmNlVGltZVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgLy8gR2V0IHByb2dyZXNzIGJhciBzZXJ2aWNlIGluc3RhbmNlXG4gICAgdGhpcy5wcm9ncmVzc1JlZiA9IHRoaXMuX25nUHJvZ3Jlc3MucmVmKHRoaXMuaWQsIHtcbiAgICAgIG1heDogdGhpcy5tYXgsXG4gICAgICBtaW46IHRoaXMubWluLFxuICAgICAgc3BlZWQ6IHRoaXMuc3BlZWQsXG4gICAgICB0cmlja2xlU3BlZWQ6IHRoaXMudHJpY2tsZVNwZWVkLFxuICAgICAgZGVib3VuY2VUaW1lOiB0aGlzLmRlYm91bmNlVGltZVxuICAgIH0pO1xuXG4gICAgLy8gU3Vic2NyaWJlIHRvIHByb2dyZXNzIHN0YXRlXG4gICAgdGhpcy5zdGF0ZSQgPSB0aGlzLnByb2dyZXNzUmVmLnN0YXRlLnBpcGUoXG4gICAgICBtYXAoKHN0YXRlOiBOZ1Byb2dyZXNzU3RhdGUpID0+ICh7XG4gICAgICAgIGFjdGl2ZTogc3RhdGUuYWN0aXZlLFxuICAgICAgICB0cmFuc2Zvcm06IGB0cmFuc2xhdGUzZCgke3N0YXRlLnZhbHVlfSUsMCwwKWBcbiAgICAgIH0pKVxuICAgICk7XG5cbiAgICAvLyBTdWJzY3JpYmVzIHRvIHN0YXJ0ZWQgYW5kIGNvbXBsZXRlZCBldmVudHMgb24gZGVtYW5kXG4gICAgaWYgKHRoaXMuc3RhcnRlZC5vYnNlcnZlcnMubGVuZ3RoKSB7XG4gICAgICB0aGlzLl9zdGFydGVkID0gdGhpcy5wcm9ncmVzc1JlZi5zdGFydGVkLnN1YnNjcmliZSgoKSA9PiB0aGlzLnN0YXJ0ZWQuZW1pdCgpKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuY29tcGxldGVkLm9ic2VydmVycy5sZW5ndGgpIHtcbiAgICAgIHRoaXMuX2NvbXBsZXRlZCA9IHRoaXMucHJvZ3Jlc3NSZWYuY29tcGxldGVkLnN1YnNjcmliZSgoKSA9PiB0aGlzLmNvbXBsZXRlZC5lbWl0KCkpO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMuX3N0YXJ0ZWQudW5zdWJzY3JpYmUoKTtcbiAgICB0aGlzLl9jb21wbGV0ZWQudW5zdWJzY3JpYmUoKTtcbiAgICBpZiAodGhpcy5wcm9ncmVzc1JlZiBpbnN0YW5jZW9mIE5nUHJvZ3Jlc3NSZWYpIHtcbiAgICAgIHRoaXMucHJvZ3Jlc3NSZWYuZGVzdHJveSgpO1xuICAgIH1cbiAgfVxuXG4gIHN0YXJ0KCkge1xuICAgIHRoaXMucHJvZ3Jlc3NSZWYuc3RhcnQoKTtcbiAgfVxuXG4gIGNvbXBsZXRlKCkge1xuICAgIHRoaXMucHJvZ3Jlc3NSZWYuY29tcGxldGUoKTtcbiAgfVxuXG4gIGluYyhuPzogbnVtYmVyKSB7XG4gICAgdGhpcy5wcm9ncmVzc1JlZi5pbmMobik7XG4gIH1cblxuICBzZXQobjogbnVtYmVyKSB7XG4gICAgdGhpcy5wcm9ncmVzc1JlZi5zZXQobik7XG4gIH1cbn1cbiJdfQ==