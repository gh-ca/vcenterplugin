!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("@angular/forms"),require("@ngx-formly/core")):"function"==typeof define&&define.amd?define("@ngx-formly/core/json-schema",["exports","@angular/core","@angular/forms","@ngx-formly/core"],r):r((e["ngx-formly"]=e["ngx-formly"]||{},e["ngx-formly"].core=e["ngx-formly"].core||{},e["ngx-formly"].core["json-schema"]={}),e.ng.core,e.ng.forms,e["ngx-formly"].core)}(this,function(e,r,c,s){"use strict";var d=function(){return(d=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);return e}).apply(this,arguments)};function f(e,r){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)r.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(t[n[i]]=e[n[i]])}return t}function y(e,r){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var n,i,o=t.call(e),u=[];try{for(;(void 0===r||0<r--)&&!(n=o.next()).done;)u.push(n.value)}catch(a){i={error:a}}finally{try{n&&!n.done&&(t=o["return"])&&t.call(o)}finally{if(i)throw i.error}}return u}function p(e){return""===e||e===undefined||null===e}function m(e){return e.hasOwnProperty("const")||e["enum"]&&1===e["enum"].length}function h(e){return e.key&&!e.fieldGroup?s.ɵgetFieldInitialValue(e)!==undefined?1:0:e.fieldGroup.reduce(function(e,r){return h(r)+e},0)}var t=function(){function e(){}return e.prototype.toFieldConfig=function(e,r){return this._toFieldConfig(e,d({schema:e},r||{}))},e.prototype._toFieldConfig=function(t,u){var a=this;t=this.resolveSchema(t,u);var l={type:this.guessType(t),defaultValue:t["default"],templateOptions:{label:t.title,readonly:t.readOnly,description:t.description}};switch(u.autoClear&&(l.autoClear=!0),l.type){case"null":this.addValidator(l,"null",function(e){return null===e.value});break;case"number":case"integer":l.parsers=[function(e){return p(e)?null:Number(e)}],t.hasOwnProperty("minimum")&&(l.templateOptions.min=t.minimum),t.hasOwnProperty("maximum")&&(l.templateOptions.max=t.maximum),t.hasOwnProperty("exclusiveMinimum")&&(l.templateOptions.exclusiveMinimum=t.exclusiveMinimum,this.addValidator(l,"exclusiveMinimum",function(e){var r=e.value;return p(r)||r>t.exclusiveMinimum})),t.hasOwnProperty("exclusiveMaximum")&&(l.templateOptions.exclusiveMaximum=t.exclusiveMaximum,this.addValidator(l,"exclusiveMaximum",function(e){var r=e.value;return p(r)||r<t.exclusiveMaximum})),t.hasOwnProperty("multipleOf")&&(l.templateOptions.step=t.multipleOf,this.addValidator(l,"multipleOf",function(e){var r=e.value;return p(r)||r%t.multipleOf==0}));break;case"string":var e=t.type;Array.isArray(e)&&-1!==e.indexOf("null")&&(l.parsers=[function(e){return p(e)?null:e}]),["minLength","maxLength","pattern"].forEach(function(e){t.hasOwnProperty(e)&&(l.templateOptions[e]=t[e])});break;case"object":l.fieldGroup=[];var r=y(this.resolveDependencies(t),2),n=r[0],i=r[1];Object.keys(t.properties||{}).forEach(function(o){var e=a._toFieldConfig(t.properties[o],u);if(l.fieldGroup.push(e),e.key=o,Array.isArray(t.required)&&-1!==t.required.indexOf(o)&&(e.templateOptions.required=!0),e.templateOptions&&!e.templateOptions.required&&n[o]&&(e.expressionProperties={"templateOptions.required":function(r){return r&&n[o].some(function(e){return!p(r[e])})}}),i[o]){var r=i[o].oneOf;r&&r.every(function(e){return e.properties&&e.properties[o]&&m(e.properties[o])})?r.forEach(function(e){var r=e.properties,t=o,n=r[t],i=f(r,["symbol"==typeof t?t:t+""]);l.fieldGroup.push(d({},a._toFieldConfig(d({},e,{properties:i}),d({},u,{autoClear:!0})),{hideExpression:function(e){return!e||((r=n).hasOwnProperty("const")?r["const"]:r["enum"][0])!==e[o];var r}}))}):l.fieldGroup.push(d({},a._toFieldConfig(i[o],u),{hideExpression:function(e){return!e||p(e[o])}}))}}),t.oneOf&&l.fieldGroup.push(this.resolveMultiSchema("oneOf",t.oneOf,u)),t.anyOf&&l.fieldGroup.push(this.resolveMultiSchema("anyOf",t.anyOf,u));break;case"array":if(t.hasOwnProperty("minItems")&&(l.templateOptions.minItems=t.minItems,this.addValidator(l,"minItems",function(e){var r=e.value;return p(r)||r.length>=t.minItems})),t.hasOwnProperty("maxItems")&&(l.templateOptions.maxItems=t.maxItems,this.addValidator(l,"maxItems",function(e){var r=e.value;return p(r)||r.length<=t.maxItems})),t.hasOwnProperty("uniqueItems")&&(l.templateOptions.uniqueItems=t.uniqueItems,this.addValidator(l,"uniqueItems",function(e){var r=e.value;return!(!p(r)&&t.uniqueItems)||Array.from(new Set(r.map(function(e){return JSON.stringify(e)}))).length===r.length})),t.items&&!Array.isArray(t.items)&&(t.items=this.resolveSchema(t.items,u)),!this.isEnum(t)){var o=this;Object.defineProperty(l,"fieldArray",{get:function(){if(!Array.isArray(t.items))return o._toFieldConfig(t.items,u);var e=this.fieldGroup?this.fieldGroup.length:0,r=t.items[e]?t.items[e]:t.additionalItems;return r?o._toFieldConfig(r,u):{}},enumerable:!0,configurable:!0})}}return t.hasOwnProperty("const")&&(l.templateOptions["const"]=t["const"],this.addValidator(l,"const",function(e){return e.value===t["const"]}),l.type||(l.defaultValue=t["const"])),this.isEnum(t)&&(l.templateOptions.multiple="array"===l.type,l.type="enum",l.templateOptions.options=this.toEnumOptions(t)),t.widget&&t.widget.formlyConfig&&(l=s.ɵreverseDeepMerge(t.widget.formlyConfig,l)),u.map?u.map(l,t):l},e.prototype.resolveSchema=function(e,r){return e.$ref&&(e=this.resolveDefinition(e,r)),e.allOf&&(e=this.resolveAllOf(e,r)),e},e.prototype.resolveAllOf=function(e,i){var o=this,r=e.allOf,t=f(e,["allOf"]);if(!r.length)throw Error("allOf array can not be empty "+r+".");return r.reduce(function(r,t){return t=o.resolveSchema(t,i),r.required&&t.required&&(r.required=function n(){for(var e=[],r=0;r<arguments.length;r++)e=e.concat(y(arguments[r]));return e}(r.required,t.required)),t.uniqueItems&&(r.uniqueItems=t.uniqueItems),["maxLength","maximum","exclusiveMaximum","maxItems","maxProperties"].forEach(function(e){p(r[e])||p(t[e])||(r[e]=r[e]<t[e]?r[e]:t[e])}),["minLength","minimum","exclusiveMinimum","minItems","minProperties"].forEach(function(e){p(r[e])||p(t[e])||(r[e]=r[e]>t[e]?r[e]:t[e])}),s.ɵreverseDeepMerge(r,t)},t)},e.prototype.resolveMultiSchema=function(s,f,p){var m=this;return{type:"multischema",fieldGroup:[{type:"enum",templateOptions:{multiple:"anyOf"===s,options:f.map(function(e,r){return{label:e.title,value:r}})}},{fieldGroup:f.map(function(e,l){return d({},m._toFieldConfig(e,d({},p,{autoClear:!0})),{hideExpression:function(e,r,t){var n=t.parent.parent.fieldGroup[0];if(!n.formControl){var i=t.parent.fieldGroup.map(function(e,r){return[e,r]}).filter(function(e){var r=y(e,2),t=r[0],n=r[1];return m.isFieldValid(t,f[n],p)}).sort(function(e,r){var t=y(e,1)[0],n=y(r,1)[0],i=h(t),o=h(n);return i===o?0:i<o?1:-1}).map(function(e){return y(e,2)[1]}),o=[0===i.length?0:i[0]],u="anyOf"===s?o:o[0];n.formControl=new c.FormControl(u)}var a=n.formControl;return Array.isArray(a.value)?-1===a.value.indexOf(l):a.value!==l}})})}]}},e.prototype.resolveDefinition=function(t,e){var r=y(t.$ref.split("#/"),2),n=r[0],i=r[1];if(n)throw Error("Remote schemas for "+t.$ref+" not supported yet.");var o=i?i.split("/").reduce(function(e,r){return e&&e.hasOwnProperty(r)?e[r]:null},e.schema):null;if(!o)throw Error("Cannot find a definition for "+t.$ref+".");return o.$ref?this.resolveDefinition(o,e):d({},o,["title","description","default"].reduce(function(e,r){return t.hasOwnProperty(r)&&(e[r]=t[r]),e},{}))},e.prototype.resolveDependencies=function(t){var n={},i={};return Object.keys(t.dependencies||{}).forEach(function(r){var e=t.dependencies[r];Array.isArray(e)?e.forEach(function(e){n[e]?n[e].push(r):n[e]=[r]}):i[r]=e}),[n,i]},e.prototype.guessType=function(e){var r=e.type;if(!r&&e.properties)return"object";if(Array.isArray(r)){if(1===r.length)return r[0];if(2===r.length&&-1!==r.indexOf("null"))return r["null"===r[0]?1:0]}return r},e.prototype.addValidator=function(e,r,t){e.validators=e.validators||{},e.validators[r]=t},e.prototype.isEnum=function(e){return e["enum"]||e.anyOf&&e.anyOf.every(m)||e.oneOf&&e.oneOf.every(m)||e.uniqueItems&&e.items&&!Array.isArray(e.items)&&this.isEnum(e.items)},e.prototype.toEnumOptions=function(e){if(e["enum"])return e["enum"].map(function(e){return{value:e,label:e}});var r=function(e){var r=e.hasOwnProperty("const")?e["const"]:e["enum"][0];return{value:r,label:e.title||r}};return e.anyOf?e.anyOf.map(r):e.oneOf?e.oneOf.map(r):this.toEnumOptions(e.items)},e.prototype.isFieldValid=function(e,r,t){return e.options._buildField({form:new c.FormGroup({}),fieldGroup:[this._toFieldConfig(r,t)],model:e.model}).form.valid},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=r.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}();e.FormlyJsonschema=t,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-formly-core-json-schema.umd.min.js.map