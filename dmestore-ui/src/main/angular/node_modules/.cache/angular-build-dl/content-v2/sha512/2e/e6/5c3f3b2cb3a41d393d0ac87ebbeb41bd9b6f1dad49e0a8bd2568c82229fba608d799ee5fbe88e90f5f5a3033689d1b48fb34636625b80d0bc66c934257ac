(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{MEKK:function(t,c,e){"use strict";e.r(c),e.d(c,"IscsiModule",(function(){return R}));var s=e("ofXK"),n=e("tyNb"),o=e("6rlL"),i=e("/Kh9"),r=e("fXoL"),l=e("tk/3"),a=e("3Pt+"),b=e("8MG2"),g=e("sYmb");function d(t,c){if(1&t&&(r.Ub(0,"option",11),r.Kc(1),r.Tb()),2&t){const t=c.$implicit;r.nc("value",t.device),r.Cb(1),r.Nc("",t.ipAddress,"(",t.device,")")}}function p(t,c){if(1&t&&(r.Ub(0,"option",11),r.Kc(1),r.Tb()),2&t){const t=c.$implicit;r.nc("value",t.sn),r.Cb(1),r.Lc(t.name)}}function m(t,c){1&t&&(r.Ub(0,"span"),r.Kc(1,"--"),r.Tb())}function h(t,c){if(1&t&&(r.Ub(0,"span"),r.Kc(1),r.Tb()),2&t){const t=r.gc().$implicit;r.Cb(1),r.Lc(t.mac)}}function u(t,c){1&t&&(r.Ub(0,"span"),r.Kc(1,"--"),r.Tb())}function f(t,c){if(1&t&&(r.Ub(0,"span"),r.Kc(1),r.Tb()),2&t){const t=r.gc().$implicit;r.Cb(1),r.Lc(t.maxSpeed)}}function C(t,c){1&t&&(r.Ub(0,"span"),r.Kc(1,"--"),r.Tb())}function I(t,c){if(1&t&&(r.Ub(0,"span"),r.Kc(1),r.Tb()),2&t){const t=r.gc().$implicit;r.Cb(1),r.Lc(t.mgmtIp)}}function U(t,c){1&t&&(r.Ub(0,"span"),r.Kc(1,"--"),r.Tb())}function T(t,c){if(1&t&&(r.Ub(0,"span"),r.Kc(1),r.Tb()),2&t){const t=r.gc().$implicit;r.Cb(1),r.Lc(t.mgmtIpv6)}}function v(t,c){1&t&&(r.Ub(0,"span"),r.Kc(1,"--"),r.Tb())}function K(t,c){if(1&t&&(r.Ub(0,"span"),r.Kc(1),r.Tb()),2&t){const t=r.gc().$implicit;r.Cb(1),r.Lc(t.speed)}}function L(t,c){1&t&&(r.Ub(0,"span"),r.Pb(1,"span",14),r.Tb()),2&t&&(r.Cb(1),r.Fc("background-color","green"))}function M(t,c){1&t&&(r.Ub(0,"span"),r.Pb(1,"span",14),r.Tb()),2&t&&(r.Cb(1),r.Fc("background-color","red"))}function D(t,c){if(1&t&&(r.Ub(0,"clr-dg-row",12),r.Ub(1,"clr-dg-cell"),r.Kc(2),r.Tb(),r.Ub(3,"clr-dg-cell"),r.Kc(4),r.Tb(),r.Ub(5,"clr-dg-cell"),r.Ic(6,m,2,0,"span",13),r.Ic(7,h,2,1,"span",13),r.Tb(),r.Ub(8,"clr-dg-cell"),r.Ic(9,u,2,0,"span",13),r.Ic(10,f,2,1,"span",13),r.Tb(),r.Ub(11,"clr-dg-cell"),r.Ic(12,C,2,0,"span",13),r.Ic(13,I,2,1,"span",13),r.Tb(),r.Ub(14,"clr-dg-cell"),r.Ic(15,U,2,0,"span",13),r.Ic(16,T,2,1,"span",13),r.Tb(),r.Ub(17,"clr-dg-cell"),r.Ic(18,v,2,0,"span",13),r.Ic(19,K,2,1,"span",13),r.Tb(),r.Ub(20,"clr-dg-cell"),r.Kc(21),r.Tb(),r.Ub(22,"clr-dg-cell"),r.Ic(23,L,2,2,"span",13),r.Ic(24,M,2,2,"span",13),r.Tb(),r.Tb()),2&t){const t=c.$implicit;r.mc("clrDgSelectable","true"==t.connectStatus)("clrDgItem",t),r.Cb(2),r.Lc(t.location),r.Cb(2),r.Lc(t.portName),r.Cb(2),r.mc("ngIf",""==t.mac),r.Cb(1),r.mc("ngIf",""!=t.mac),r.Cb(2),r.mc("ngIf",-1==t.maxSpeed),r.Cb(1),r.mc("ngIf",-1!=t.maxSpeed),r.Cb(2),r.mc("ngIf",""==t.mgmtIp),r.Cb(1),r.mc("ngIf",""!=t.mgmtIp),r.Cb(2),r.mc("ngIf",""==t.mgmtIpv6),r.Cb(1),r.mc("ngIf",""!=t.mgmtIpv6),r.Cb(2),r.mc("ngIf",-1==t.speed),r.Cb(1),r.mc("ngIf",-1!=t.speed),r.Cb(2),r.Lc(t.status),r.Cb(2),r.mc("ngIf","true"==t.connectStatus),r.Cb(1),r.mc("ngIf","false"==t.connectStatus||""==t.mgmtIp||null==t.mgmtIp)}}let O=(()=>{class t{constructor(t,c,e,s){this.cdr=t,this.http=c,this.commonService=e,this.gs=s,this.testPortConnectedUrl="accesshost/testconnectivity",this.portGetUrl="dmestorage/getstorageethports",this.portGetUrlParams={params:{storageSn:""}},this.ipsGetUrl="accessvmware/getvmkernelipbyhostobjectid",this.ipsGetUrlParams={params:{hostObjectId:""}},this.storageGetUrl="dmestorage/storages",this.configIscsiUrl="accesshost/configureiscsi",this.storageDevices=[],this.ips=[],this.configModel={hostObjectId:"",vmKernel:{device:""},ethPorts:[],sn:""},this.hostObjectId="",this.portLoading=!1,this.portList=[],this.portTotal=0}ngOnInit(){}ngAfterViewInit(){const t=this.gs.getClientSdk().app.getContextObjects();console.log(t),this.hostObjectId=null==t?"urn:vmomi:HostSystem:host-1034:674908e5-ab21-4079-9cb1-596358ee5dd1":t[0].id,this.ipsGetUrlParams.params.hostObjectId=this.hostObjectId,this.configModel.hostObjectId=this.hostObjectId,this.loadIps(),this.loadStorageDevice()}loadIps(){this.http.get(this.ipsGetUrl,this.ipsGetUrlParams).subscribe(t=>{"0"!==t.code&&"200"!==t.code||(this.ips=t.data,this.cdr.detectChanges())},t=>{console.error("ERROR",t)})}loadStorageDevice(){this.http.get(this.storageGetUrl,{}).subscribe(t=>{"200"===t.code&&(this.storageDevices=t.data.data,setTimeout(()=>{this.loadPorts()},1e3),this.cdr.detectChanges())},t=>{console.error("ERROR",t)})}loadPorts(){""!==this.configModel.sn&&""!==this.configModel.vmKernel.device&&(this.portLoading=!0,this.portGetUrlParams.params.storageSn=this.configModel.sn,this.http.get(this.portGetUrl,this.portGetUrlParams).subscribe(t=>{"0"!==t.code&&"200"!==t.code||(t.data.forEach(t=>{t.connectStatus=""}),this.portList=t.data,this.portTotal=t.data.length,this.cdr.detectChanges(),this.portLoading=!1,this.testPortConnected())},t=>{console.error("ERROR",t),this.portLoading=!1}))}testPortConnected(){const t=new S,c=[];this.portList.forEach(t=>{t.mgmtIp&&""!=t.mgmtIp&&c.push(t)}),t.ethPorts=c,t.hostObjectId=this.configModel.hostObjectId,t.vmKernel=this.configModel.vmKernel,this.http.post(this.testPortConnectedUrl,t).subscribe(t=>{"200"===t.code&&t.data?(t.data.forEach(t=>{this.portList.forEach(c=>{t.id==c.id&&(c.connectStatus=t.connectStatus)})}),this.cdr.detectChanges()):alert("\u6d4b\u8bd5\u8fde\u901a\u6027\u51fa\u9519")},t=>{console.error("ERROR",t)})}submit(){console.log(this.configModel),this.http.post(this.configIscsiUrl,this.configModel).subscribe(t=>{},t=>{console.error("ERROR",t)})}}return t.\u0275fac=function(c){return new(c||t)(r.Ob(r.h),r.Ob(l.b),r.Ob(o.a),r.Ob(i.b))},t.\u0275cmp=r.Ib({type:t,selectors:[["app-iscsi"]],features:[r.Bb([o.a,i.b])],decls:56,vars:55,consts:[[2,"margin-left","30px"],["clrForm",""],["clrSelect","","name","hostIp",3,"ngModel","change","ngModelOptions","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["clrSelect","","name","storageDeviceId",3,"ngModel","change","ngModelOptions","ngModelChange"],[2,"margin-top","20px"],[2,"margin-top","2%"],[3,"clrDgSelected","clrDgLoading","clrDgSelectedChange"],[3,"clrDgField"],[3,"clrDgSelectable","clrDgItem",4,"clrDgItems","clrDgItemsOf"],["type","button",1,"btn","btn-primary",2,"display","block","margin","0 auto",3,"click"],[3,"value"],[3,"clrDgSelectable","clrDgItem"],[4,"ngIf"],[1,"color-square"]],template:function(t,c){1&t&&(r.Ub(0,"div"),r.Ub(1,"div",0),r.Ub(2,"div"),r.Ub(3,"form",1),r.Ub(4,"clr-select-container"),r.Ub(5,"label"),r.Kc(6),r.hc(7,"translate"),r.Tb(),r.Kc(8,": "),r.Ub(9,"select",2),r.cc("change",(function(){return c.loadPorts()}))("ngModelOptions",(function(){return c.ips}))("ngModelChange",(function(t){return c.configModel.vmKernel.device=t})),r.Ic(10,d,2,3,"option",3),r.Tb(),r.Tb(),r.Ub(11,"clr-select-container"),r.Ub(12,"label"),r.Kc(13),r.hc(14,"translate"),r.Tb(),r.Kc(15,": "),r.Ub(16,"select",4),r.cc("change",(function(){return c.loadPorts()}))("ngModelOptions",(function(){return c.storageDevices}))("ngModelChange",(function(t){return c.configModel.sn=t})),r.Ic(17,p,2,2,"option",3),r.Tb(),r.Tb(),r.Tb(),r.Tb(),r.Ub(18,"div",5),r.Ub(19,"p",6),r.Kc(20),r.hc(21,"translate"),r.Tb(),r.Sb(22),r.Ub(23,"clr-datagrid",7),r.cc("clrDgSelectedChange",(function(t){return c.configModel.ethPorts=t})),r.Ub(24,"clr-dg-column",8),r.Kc(25),r.hc(26,"translate"),r.Tb(),r.Ub(27,"clr-dg-column",8),r.Kc(28),r.hc(29,"translate"),r.Tb(),r.Ub(30,"clr-dg-column",8),r.Kc(31),r.hc(32,"translate"),r.Tb(),r.Ub(33,"clr-dg-column",8),r.Kc(34),r.hc(35,"translate"),r.Tb(),r.Ub(36,"clr-dg-column",8),r.Kc(37),r.hc(38,"translate"),r.Tb(),r.Ub(39,"clr-dg-column",8),r.Kc(40),r.hc(41,"translate"),r.Tb(),r.Ub(42,"clr-dg-column",8),r.Kc(43),r.hc(44,"translate"),r.Tb(),r.Ub(45,"clr-dg-column",8),r.Kc(46),r.hc(47,"translate"),r.Tb(),r.Ub(48,"clr-dg-column",8),r.Kc(49),r.hc(50,"translate"),r.Tb(),r.Ic(51,D,25,17,"clr-dg-row",9),r.Tb(),r.Rb(),r.Tb(),r.Ub(52,"div",5),r.Ub(53,"button",10),r.cc("click",(function(){return c.submit()})),r.Kc(54),r.hc(55,"translate"),r.Tb(),r.Tb(),r.Tb(),r.Tb()),2&t&&(r.Cb(6),r.Lc(r.ic(7,29,"iscsi.hostIp")),r.Cb(3),r.mc("ngModel",c.configModel.vmKernel.device),r.Cb(1),r.mc("ngForOf",c.ips),r.Cb(3),r.Lc(r.ic(14,31,"iscsi.storage")),r.Cb(3),r.mc("ngModel",c.configModel.sn),r.Cb(1),r.mc("ngForOf",c.storageDevices),r.Cb(3),r.Lc(r.ic(21,33,"iscsi.ports")),r.Cb(3),r.mc("clrDgSelected",c.configModel.ethPorts)("clrDgLoading",c.portLoading),r.Cb(1),r.mc("clrDgField","location"),r.Cb(1),r.Lc(r.ic(26,35,"iscsi.location")),r.Cb(2),r.mc("clrDgField","portName"),r.Cb(1),r.Lc(r.ic(29,37,"iscsi.portName")),r.Cb(2),r.mc("clrDgField","mac"),r.Cb(1),r.Lc(r.ic(32,39,"iscsi.mac")),r.Cb(2),r.mc("clrDgField","maxSpeed"),r.Cb(1),r.Lc(r.ic(35,41,"iscsi.maxSpeed")),r.Cb(2),r.mc("clrDgField","mgmtIp"),r.Cb(1),r.Lc(r.ic(38,43,"iscsi.ip4")),r.Cb(2),r.mc("clrDgField","mgmtIpv6"),r.Cb(1),r.Lc(r.ic(41,45,"iscsi.ip6")),r.Cb(2),r.mc("clrDgField","speed"),r.Cb(1),r.Lc(r.ic(44,47,"iscsi.speed")),r.Cb(2),r.mc("clrDgField","status"),r.Cb(1),r.Lc(r.ic(47,49,"iscsi.hStatus")),r.Cb(2),r.mc("clrDgField","connectStatus"),r.Cb(1),r.Lc(r.ic(50,51,"iscsi.cStatus")),r.Cb(2),r.mc("clrDgItemsOf",c.portList),r.Cb(3),r.Lc(r.ic(55,53,"menu.ok")))},directives:[a.E,a.r,a.s,b.A,b.W,b.H,a.A,b.V,a.q,a.t,s.m,b.m,b.qb,b.sb,b.lb,b.tb,b.o,b.pb,b.r,a.v,a.D,b.v,b.rb,b.n,b.nb,s.n],pipes:[g.c],styles:[".modal-dialog.modal-lg{width:1280px}.color-square[_ngcontent-%COMP%]{display:inline-block;vertical-align:text-bottom;height:.7rem;width:.7rem;border:.05rem solid #000;border-radius:.2rem}"]}),t})();class S{}const P=[{path:"",component:O}];let F=(()=>{class t{}return t.\u0275mod=r.Mb({type:t}),t.\u0275inj=r.Lb({factory:function(c){return new(c||t)},imports:[[n.i.forChild(P)],n.i]}),t})();var w=e("M0ag");let R=(()=>{class t{}return t.\u0275mod=r.Mb({type:t}),t.\u0275inj=r.Lb({factory:function(c){return new(c||t)},imports:[[s.c,w.a,F]]}),t})()}}]);