(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{MEKK:function(c,t,e){"use strict";e.r(t),e.d(t,"IscsiModule",(function(){return x}));var s=e("ofXK"),i=e("tyNb"),n=e("6rlL"),o=e("/Kh9"),r=e("8MG2"),l=e("fXoL"),a=e("tk/3"),b=e("3Pt+"),d=e("sYmb");const g=["myForm"];function p(c,t){if(1&c&&(l.Ub(0,"option",22),l.Kc(1),l.Tb()),2&c){const c=t.$implicit;l.nc("value",c.device),l.Cb(1),l.Nc("",c.ipAddress,"(",c.device,")")}}function m(c,t){if(1&c&&(l.Ub(0,"option",22),l.Kc(1),l.Tb()),2&c){const c=t.$implicit;l.nc("value",c.sn),l.Cb(1),l.Lc(c.name)}}function h(c,t){1&c&&(l.Ub(0,"span"),l.Kc(1,"--"),l.Tb())}function u(c,t){if(1&c&&(l.Ub(0,"span"),l.Kc(1),l.Tb()),2&c){const c=l.gc().$implicit;l.Cb(1),l.Lc(c.mac)}}function f(c,t){1&c&&(l.Ub(0,"span"),l.Kc(1,"--"),l.Tb())}function C(c,t){if(1&c&&(l.Ub(0,"span"),l.Kc(1),l.Tb()),2&c){const c=l.gc().$implicit;l.Cb(1),l.Lc(c.maxSpeed)}}function U(c,t){1&c&&(l.Ub(0,"span"),l.Kc(1,"--"),l.Tb())}function I(c,t){if(1&c&&(l.Ub(0,"span"),l.Kc(1),l.Tb()),2&c){const c=l.gc().$implicit;l.Cb(1),l.Lc(c.mgmtIp)}}function T(c,t){1&c&&(l.Ub(0,"span"),l.Kc(1,"--"),l.Tb())}function M(c,t){if(1&c&&(l.Ub(0,"span"),l.Kc(1),l.Tb()),2&c){const c=l.gc().$implicit;l.Cb(1),l.Lc(c.mgmtIpv6)}}function v(c,t){1&c&&(l.Ub(0,"span"),l.Kc(1,"--"),l.Tb())}function K(c,t){if(1&c&&(l.Ub(0,"span"),l.Kc(1),l.Tb()),2&c){const c=l.gc().$implicit;l.Cb(1),l.Lc(c.speed)}}function L(c,t){1&c&&(l.Ub(0,"span"),l.Pb(1,"span",25),l.Tb()),2&c&&(l.Cb(1),l.Fc("background-color","green"))}function S(c,t){1&c&&(l.Ub(0,"span"),l.Pb(1,"span",25),l.Tb()),2&c&&(l.Cb(1),l.Fc("background-color","red"))}function O(c,t){1&c&&(l.Ub(0,"span"),l.Pb(1,"img",26),l.Tb())}function D(c,t){if(1&c&&(l.Ub(0,"clr-dg-row",23),l.Ub(1,"clr-dg-cell"),l.Kc(2),l.Tb(),l.Ub(3,"clr-dg-cell"),l.Kc(4),l.Tb(),l.Ub(5,"clr-dg-cell"),l.Ic(6,h,2,0,"span",24),l.Ic(7,u,2,1,"span",24),l.Tb(),l.Ub(8,"clr-dg-cell"),l.Ic(9,f,2,0,"span",24),l.Ic(10,C,2,1,"span",24),l.Tb(),l.Ub(11,"clr-dg-cell"),l.Ic(12,U,2,0,"span",24),l.Ic(13,I,2,1,"span",24),l.Tb(),l.Ub(14,"clr-dg-cell"),l.Ic(15,T,2,0,"span",24),l.Ic(16,M,2,1,"span",24),l.Tb(),l.Ub(17,"clr-dg-cell"),l.Ic(18,v,2,0,"span",24),l.Ic(19,K,2,1,"span",24),l.Tb(),l.Ub(20,"clr-dg-cell"),l.Kc(21),l.Tb(),l.Ub(22,"clr-dg-cell"),l.Ic(23,L,2,2,"span",24),l.Ic(24,S,2,2,"span",24),l.Ic(25,O,2,0,"span",24),l.Tb(),l.Tb()),2&c){const c=t.$implicit;l.mc("clrDgItem",c)("clrDgSelectable","true"==c.connectStatus),l.Cb(2),l.Lc(c.location),l.Cb(2),l.Lc(c.portName),l.Cb(2),l.mc("ngIf",""==c.mac),l.Cb(1),l.mc("ngIf",""!=c.mac),l.Cb(2),l.mc("ngIf",-1==c.maxSpeed),l.Cb(1),l.mc("ngIf",-1!=c.maxSpeed),l.Cb(2),l.mc("ngIf",""==c.mgmtIp),l.Cb(1),l.mc("ngIf",""!=c.mgmtIp),l.Cb(2),l.mc("ngIf",""==c.mgmtIpv6),l.Cb(1),l.mc("ngIf",""!=c.mgmtIpv6),l.Cb(2),l.mc("ngIf",-1==c.speed),l.Cb(1),l.mc("ngIf",-1!=c.speed),l.Cb(2),l.Lc(c.status),l.Cb(2),l.mc("ngIf","true"==c.connectStatus),l.Cb(1),l.mc("ngIf","false"==c.connectStatus||""==c.mgmtIp||null==c.mgmtIp),l.Cb(1),l.mc("ngIf",""==c.connectStatus&&""!=c.mgmtIp)}}let F=(()=>{class c{constructor(c,t,e,s){this.cdr=c,this.http=t,this.commonService=e,this.gs=s,this.testPortConnectedUrl="accesshost/testconnectivity",this.portGetUrl="dmestorage/getstorageethports",this.portGetUrlParams={params:{storageSn:""}},this.ipsGetUrl="accessvmware/getvmkernelipbyhostobjectid",this.ipsGetUrlParams={params:{hostObjectId:""}},this.storageGetUrl="dmestorage/storages",this.configIscsiUrl="accesshost/configureiscsi",this.storageDevices=[],this.ips=[],this.configModel={hostObjectId:"",vmKernel:{device:""},ethPorts:[],sn:""},this.hostObjectId="",this.portLoading=!1,this.portList=[],this.portTotal=0,this.tipModalSuccess=!1,this.tipModalFail=!1,this.isSubmit=!1}ngOnInit(){}ngAfterViewInit(){const c=this.gs.getClientSdk().app.getContextObjects();console.log(c),this.hostObjectId=null==c?"urn:vmomi:HostSystem:host-1034:674908e5-ab21-4079-9cb1-596358ee5dd1":c[0].id,this.ipsGetUrlParams.params.hostObjectId=this.hostObjectId,this.configModel.hostObjectId=this.hostObjectId,this.loadIps(),this.loadStorageDevice()}loadIps(){this.gs.loading=!0,this.http.get(this.ipsGetUrl,this.ipsGetUrlParams).subscribe(c=>{this.gs.loading=!1,"200"===c.code&&(this.ips=c.data,this.cdr.detectChanges())},c=>{console.error("ERROR",c)}),this.cdr.detectChanges()}loadStorageDevice(){this.gs.loading=!0,this.http.get(this.storageGetUrl,{}).subscribe(c=>{this.gs.loading=!1,"200"===c.code&&(this.storageDevices=c.data,setTimeout(()=>{this.loadPorts()},1e3),this.cdr.detectChanges())},c=>{console.error("ERROR",c)})}loadPorts(){""!==this.configModel.sn&&""!==this.configModel.vmKernel.device&&(this.portLoading=!0,this.portGetUrlParams.params.storageSn=this.configModel.sn,this.http.get(this.portGetUrl,this.portGetUrlParams).subscribe(c=>{"200"===c.code&&(c.data.forEach(c=>{c.connectStatus=""}),this.portList=c.data,this.portTotal=c.data.length,this.cdr.detectChanges(),this.portLoading=!1,this.testPortConnected())},c=>{console.error("ERROR",c),this.portLoading=!1}))}testPortConnected(){const c=new P,t=[];this.portList.forEach(c=>{c.mgmtIp&&""!=c.mgmtIp&&t.push(c)}),c.ethPorts=t,c.hostObjectId=this.configModel.hostObjectId,c.vmKernel=this.configModel.vmKernel,this.http.post(this.testPortConnectedUrl,c).subscribe(c=>{"200"===c.code&&c.data?(c.data.forEach(c=>{this.portList.forEach(t=>{c.id==t.id&&(t.connectStatus=c.connectStatus)})}),this.cdr.detectChanges()):alert("\u6d4b\u8bd5\u8fde\u901a\u6027\u51fa\u9519")},c=>{console.error("ERROR",c)})}submit(){this.isSubmit=!0,this.myForm.form.invalid?this.rdmFormGroup.markAsTouched():0!=this.configModel.ethPorts.length&&(this.gs.loading=!0,this.http.post(this.configIscsiUrl,this.configModel).subscribe(c=>{this.gs.loading=!1,"200"==c.code?this.tipModalSuccess=!0:this.tipModalFail=!0,this.cdr.detectChanges()},c=>{console.error("ERROR",c)}),this.cdr.detectChanges())}}return c.\u0275fac=function(t){return new(t||c)(l.Ob(l.h),l.Ob(a.b),l.Ob(n.a),l.Ob(o.b))},c.\u0275cmp=l.Ib({type:c,selectors:[["app-iscsi"]],viewQuery:function(c,t){var e;1&c&&(l.Ec(r.A,!0),l.Ec(g,!0)),2&c&&(l.vc(e=l.dc())&&(t.rdmFormGroup=e.first),l.vc(e=l.dc())&&(t.myForm=e.first))},features:[l.Bb([n.a])],decls:97,vars:87,consts:[[2,"margin-left","30px"],["clrForm",""],["myForm","ngForm"],[2,"color","red"],["clrSelect","","required","","name","hostIp",3,"ngModel","change","ngModelOptions","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["clrSelect","","required","","name","storageDeviceId",3,"ngModel","change","ngModelOptions","ngModelChange"],[2,"margin-top","20px"],[2,"margin-top","2%"],[3,"clrDgSelected","clrDgLoading","clrDgSelectedChange"],[3,"clrDgField"],[3,"clrDgItem","clrDgSelectable",4,"clrDgItems","clrDgItemsOf"],[2,"color","#c61d00",3,"hidden"],["type","button",1,"btn","btn-primary",2,"display","block","margin","0 auto",3,"click"],[3,"clrModalOpen","clrModalSize","clrModalOpenChange"],[1,"modal-title"],[1,"modal-body"],["shape","success-standard",1,"is-solid",2,"color","#59A220","margin-right","5px"],[1,"modal-footer"],["type","button",1,"btn","btn-success",3,"click"],["shape","error-standard",1,"is-solid",2,"color","red","margin-right","5px"],["type","button",1,"btn","btn-danger",3,"click"],[3,"value"],[3,"clrDgItem","clrDgSelectable"],[4,"ngIf"],[1,"color-square"],["src","./assets/images/loading.gif","width","20px","height","20px"]],template:function(c,t){1&c&&(l.Ub(0,"div"),l.Ub(1,"div",0),l.Ub(2,"div"),l.Ub(3,"form",1,2),l.Ub(5,"clr-select-container"),l.Ub(6,"label"),l.Kc(7),l.hc(8,"translate"),l.Ub(9,"span",3),l.Kc(10,"*"),l.Tb(),l.Kc(11,":"),l.Tb(),l.Ub(12,"select",4),l.cc("change",(function(){return t.loadPorts()}))("ngModelOptions",(function(){return t.ips}))("ngModelChange",(function(c){return t.configModel.vmKernel.device=c})),l.Ic(13,p,2,3,"option",5),l.Tb(),l.Ub(14,"clr-control-error"),l.Kc(15),l.hc(16,"translate"),l.Tb(),l.Tb(),l.Ub(17,"clr-select-container"),l.Ub(18,"label"),l.Kc(19),l.hc(20,"translate"),l.Ub(21,"span",3),l.Kc(22,"*"),l.Tb(),l.Kc(23,":"),l.Tb(),l.Ub(24,"select",6),l.cc("change",(function(){return t.loadPorts()}))("ngModelOptions",(function(){return t.storageDevices}))("ngModelChange",(function(c){return t.configModel.sn=c})),l.Ic(25,m,2,2,"option",5),l.Tb(),l.Ub(26,"clr-control-error"),l.Kc(27),l.hc(28,"translate"),l.Tb(),l.Tb(),l.Tb(),l.Tb(),l.Ub(29,"div",7),l.Ub(30,"p",8),l.Kc(31),l.hc(32,"translate"),l.Ub(33,"span",3),l.Kc(34,"*"),l.Tb(),l.Tb(),l.Sb(35),l.Ub(36,"clr-datagrid",9),l.cc("clrDgSelectedChange",(function(c){return t.configModel.ethPorts=c})),l.Ub(37,"clr-dg-column",10),l.Kc(38),l.hc(39,"translate"),l.Tb(),l.Ub(40,"clr-dg-column",10),l.Kc(41),l.hc(42,"translate"),l.Tb(),l.Ub(43,"clr-dg-column",10),l.Kc(44),l.hc(45,"translate"),l.Tb(),l.Ub(46,"clr-dg-column",10),l.Kc(47),l.hc(48,"translate"),l.Tb(),l.Ub(49,"clr-dg-column",10),l.Kc(50),l.hc(51,"translate"),l.Tb(),l.Ub(52,"clr-dg-column",10),l.Kc(53),l.hc(54,"translate"),l.Tb(),l.Ub(55,"clr-dg-column",10),l.Kc(56),l.hc(57,"translate"),l.Tb(),l.Ub(58,"clr-dg-column",10),l.Kc(59),l.hc(60,"translate"),l.Tb(),l.Ub(61,"clr-dg-column",10),l.Kc(62),l.hc(63,"translate"),l.Tb(),l.Ic(64,D,26,18,"clr-dg-row",11),l.Tb(),l.Rb(),l.Ub(65,"p"),l.Ub(66,"span",12),l.Kc(67),l.hc(68,"translate"),l.Tb(),l.Tb(),l.Tb(),l.Ub(69,"div",7),l.Ub(70,"button",13),l.cc("click",(function(){return t.submit()})),l.Kc(71),l.hc(72,"translate"),l.Tb(),l.Tb(),l.Tb(),l.Tb(),l.Ub(73,"clr-modal",14),l.cc("clrModalOpenChange",(function(c){return t.tipModalSuccess=c})),l.Ub(74,"h3",15),l.Kc(75),l.hc(76,"translate"),l.Tb(),l.Ub(77,"div",16),l.Pb(78,"clr-icon",17),l.Kc(79),l.hc(80,"translate"),l.Tb(),l.Ub(81,"div",18),l.Ub(82,"button",19),l.cc("click",(function(){return t.tipModalSuccess=!1})),l.Kc(83),l.hc(84,"translate"),l.Tb(),l.Tb(),l.Tb(),l.Ub(85,"clr-modal",14),l.cc("clrModalOpenChange",(function(c){return t.tipModalFail=c})),l.Ub(86,"h3",15),l.Kc(87),l.hc(88,"translate"),l.Tb(),l.Ub(89,"div",16),l.Pb(90,"clr-icon",20),l.Kc(91),l.hc(92,"translate"),l.Tb(),l.Ub(93,"div",18),l.Ub(94,"button",21),l.cc("click",(function(){return t.tipModalFail=!1})),l.Kc(95),l.hc(96,"translate"),l.Tb(),l.Tb(),l.Tb()),2&c&&(l.Cb(7),l.Lc(l.ic(8,43,"iscsi.hostIp")),l.Cb(5),l.mc("ngModel",t.configModel.vmKernel.device),l.Cb(1),l.mc("ngForOf",t.ips),l.Cb(2),l.Lc(l.ic(16,45,"validations.required")),l.Cb(4),l.Lc(l.ic(20,47,"iscsi.storage")),l.Cb(5),l.mc("ngModel",t.configModel.sn),l.Cb(1),l.mc("ngForOf",t.storageDevices),l.Cb(2),l.Lc(l.ic(28,49,"validations.required")),l.Cb(4),l.Lc(l.ic(32,51,"iscsi.ports")),l.Cb(5),l.mc("clrDgSelected",t.configModel.ethPorts)("clrDgLoading",t.portLoading),l.Cb(1),l.mc("clrDgField","location"),l.Cb(1),l.Lc(l.ic(39,53,"iscsi.location")),l.Cb(2),l.mc("clrDgField","portName"),l.Cb(1),l.Lc(l.ic(42,55,"iscsi.portName")),l.Cb(2),l.mc("clrDgField","mac"),l.Cb(1),l.Lc(l.ic(45,57,"iscsi.mac")),l.Cb(2),l.mc("clrDgField","maxSpeed"),l.Cb(1),l.Lc(l.ic(48,59,"iscsi.maxSpeed")),l.Cb(2),l.mc("clrDgField","mgmtIp"),l.Cb(1),l.Lc(l.ic(51,61,"iscsi.ip4")),l.Cb(2),l.mc("clrDgField","mgmtIpv6"),l.Cb(1),l.Lc(l.ic(54,63,"iscsi.ip6")),l.Cb(2),l.mc("clrDgField","speed"),l.Cb(1),l.Lc(l.ic(57,65,"iscsi.speed")),l.Cb(2),l.mc("clrDgField","status"),l.Cb(1),l.Lc(l.ic(60,67,"iscsi.hStatus")),l.Cb(2),l.mc("clrDgField","connectStatus"),l.Cb(1),l.Lc(l.ic(63,69,"iscsi.cStatus")),l.Cb(2),l.mc("clrDgItemsOf",t.portList),l.Cb(2),l.mc("hidden",0!=t.configModel.ethPorts.length||!t.isSubmit),l.Cb(1),l.Lc(l.ic(68,71,"iscsi.portNullMessage")),l.Cb(4),l.Lc(l.ic(72,73,"menu.ok")),l.Cb(2),l.mc("clrModalOpen",t.tipModalSuccess)("clrModalSize","sm"),l.Cb(2),l.Lc(l.ic(76,75,"menu.tip")),l.Cb(4),l.Mc("",l.ic(80,77,"bestPractice.exeSuccess")," "),l.Cb(4),l.Lc(l.ic(84,79,"menu.ok")),l.Cb(2),l.mc("clrModalOpen",t.tipModalFail)("clrModalSize","sm"),l.Cb(2),l.Lc(l.ic(88,81,"menu.tip")),l.Cb(4),l.Mc("",l.ic(92,83,"bestPractice.exeFail")," "),l.Cb(4),l.Lc(l.ic(96,85,"menu.ok")))},directives:[b.E,b.r,b.s,r.A,r.V,r.H,b.A,r.U,b.z,b.q,b.t,s.m,r.k,r.m,r.qb,r.sb,r.lb,r.tb,r.o,r.pb,r.r,r.J,r.K,r.B,b.v,b.D,r.v,r.rb,r.n,r.nb,s.n],pipes:[d.c],styles:[".color-square[_ngcontent-%COMP%]{display:inline-block;vertical-align:text-bottom;height:.7rem;width:.7rem;border:.05rem solid #000;border-radius:.2rem}  .clr-select-wrapper select{width:200px}"]}),c})();class P{}const y=[{path:"",component:F}];let k=(()=>{class c{}return c.\u0275mod=l.Mb({type:c}),c.\u0275inj=l.Lb({factory:function(t){return new(t||c)},imports:[[i.i.forChild(y)],i.i]}),c})();var w=e("M0ag");let x=(()=>{class c{}return c.\u0275mod=l.Mb({type:c}),c.\u0275inj=l.Lb({factory:function(t){return new(t||c)},imports:[[s.c,w.a,k]]}),c})()}}]);