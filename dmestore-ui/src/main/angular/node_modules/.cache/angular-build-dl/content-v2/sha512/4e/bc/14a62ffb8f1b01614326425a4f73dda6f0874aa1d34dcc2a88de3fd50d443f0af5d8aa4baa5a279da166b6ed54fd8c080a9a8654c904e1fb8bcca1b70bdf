!function(){function c(c,t){if(!(c instanceof t))throw new TypeError("Cannot call a class as a function")}function t(c,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(c,n.key,n)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{MEKK:function(e,n,i){"use strict";i.r(n),i.d(n,"IscsiModule",(function(){return q}));var o=i("ofXK"),s=i("tyNb"),r=i("6rlL"),a=i("/Kh9"),l=i("8MG2"),b=i("fXoL"),d=i("tk/3"),g=i("3Pt+"),p=i("sYmb"),m=["myForm"];function u(c,t){if(1&c&&(b.Ub(0,"option",22),b.Kc(1),b.Tb()),2&c){var e=t.$implicit;b.nc("value",e.device),b.Cb(1),b.Nc("",e.ipAddress,"(",e.device,")")}}function h(c,t){if(1&c&&(b.Ub(0,"option",22),b.Kc(1),b.Tb()),2&c){var e=t.$implicit;b.nc("value",e.sn),b.Cb(1),b.Lc(e.name)}}function f(c,t){1&c&&(b.Ub(0,"span"),b.Kc(1,"--"),b.Tb())}function C(c,t){if(1&c&&(b.Ub(0,"span"),b.Kc(1),b.Tb()),2&c){var e=b.gc().$implicit;b.Cb(1),b.Lc(e.mac)}}function U(c,t){1&c&&(b.Ub(0,"span"),b.Kc(1,"--"),b.Tb())}function v(c,t){if(1&c&&(b.Ub(0,"span"),b.Kc(1),b.Tb()),2&c){var e=b.gc().$implicit;b.Cb(1),b.Lc(e.maxSpeed)}}function T(c,t){1&c&&(b.Ub(0,"span"),b.Kc(1,"--"),b.Tb())}function I(c,t){if(1&c&&(b.Ub(0,"span"),b.Kc(1),b.Tb()),2&c){var e=b.gc().$implicit;b.Cb(1),b.Lc(e.mgmtIp)}}function M(c,t){1&c&&(b.Ub(0,"span"),b.Kc(1,"--"),b.Tb())}function K(c,t){if(1&c&&(b.Ub(0,"span"),b.Kc(1),b.Tb()),2&c){var e=b.gc().$implicit;b.Cb(1),b.Lc(e.mgmtIpv6)}}function L(c,t){1&c&&(b.Ub(0,"span"),b.Kc(1,"--"),b.Tb())}function S(c,t){if(1&c&&(b.Ub(0,"span"),b.Kc(1),b.Tb()),2&c){var e=b.gc().$implicit;b.Cb(1),b.Lc(e.speed)}}function O(c,t){1&c&&(b.Ub(0,"span"),b.Pb(1,"span",25),b.Tb()),2&c&&(b.Cb(1),b.Fc("background-color","green"))}function y(c,t){1&c&&(b.Ub(0,"span"),b.Pb(1,"span",25),b.Tb()),2&c&&(b.Cb(1),b.Fc("background-color","red"))}function D(c,t){1&c&&(b.Ub(0,"span"),b.Pb(1,"img",26),b.Tb())}function F(c,t){if(1&c&&(b.Ub(0,"clr-dg-row",23),b.Ub(1,"clr-dg-cell"),b.Kc(2),b.Tb(),b.Ub(3,"clr-dg-cell"),b.Kc(4),b.Tb(),b.Ub(5,"clr-dg-cell"),b.Ic(6,f,2,0,"span",24),b.Ic(7,C,2,1,"span",24),b.Tb(),b.Ub(8,"clr-dg-cell"),b.Ic(9,U,2,0,"span",24),b.Ic(10,v,2,1,"span",24),b.Tb(),b.Ub(11,"clr-dg-cell"),b.Ic(12,T,2,0,"span",24),b.Ic(13,I,2,1,"span",24),b.Tb(),b.Ub(14,"clr-dg-cell"),b.Ic(15,M,2,0,"span",24),b.Ic(16,K,2,1,"span",24),b.Tb(),b.Ub(17,"clr-dg-cell"),b.Ic(18,L,2,0,"span",24),b.Ic(19,S,2,1,"span",24),b.Tb(),b.Ub(20,"clr-dg-cell"),b.Kc(21),b.Tb(),b.Ub(22,"clr-dg-cell"),b.Ic(23,O,2,2,"span",24),b.Ic(24,y,2,2,"span",24),b.Ic(25,D,2,0,"span",24),b.Tb(),b.Tb()),2&c){var e=t.$implicit;b.mc("clrDgItem",e)("clrDgSelectable","true"==e.connectStatus),b.Cb(2),b.Lc(e.location),b.Cb(2),b.Lc(e.portName),b.Cb(2),b.mc("ngIf",""==e.mac),b.Cb(1),b.mc("ngIf",""!=e.mac),b.Cb(2),b.mc("ngIf",-1==e.maxSpeed),b.Cb(1),b.mc("ngIf",-1!=e.maxSpeed),b.Cb(2),b.mc("ngIf",""==e.mgmtIp),b.Cb(1),b.mc("ngIf",""!=e.mgmtIp),b.Cb(2),b.mc("ngIf",""==e.mgmtIpv6),b.Cb(1),b.mc("ngIf",""!=e.mgmtIpv6),b.Cb(2),b.mc("ngIf",-1==e.speed),b.Cb(1),b.mc("ngIf",-1!=e.speed),b.Cb(2),b.Lc(e.status),b.Cb(2),b.mc("ngIf","true"==e.connectStatus),b.Cb(1),b.mc("ngIf","false"==e.connectStatus||""==e.mgmtIp||null==e.mgmtIp),b.Cb(1),b.mc("ngIf",""==e.connectStatus&&""!=e.mgmtIp)}}var P,k,w,x=((P=function(){function e(t,n,i,o){c(this,e),this.cdr=t,this.http=n,this.commonService=i,this.gs=o,this.testPortConnectedUrl="accesshost/testconnectivity",this.portGetUrl="dmestorage/getstorageethports",this.portGetUrlParams={params:{storageSn:""}},this.ipsGetUrl="accessvmware/getvmkernelipbyhostobjectid",this.ipsGetUrlParams={params:{hostObjectId:""}},this.storageGetUrl="dmestorage/storages",this.configIscsiUrl="accesshost/configureiscsi",this.storageDevices=[],this.ips=[],this.configModel={hostObjectId:"",vmKernel:{device:""},ethPorts:[],sn:""},this.hostObjectId="",this.portLoading=!1,this.portList=[],this.portTotal=0,this.tipModalSuccess=!1,this.tipModalFail=!1,this.isSubmit=!1}var n,i,o;return n=e,(i=[{key:"ngOnInit",value:function(){}},{key:"ngAfterViewInit",value:function(){var c=this.gs.getClientSdk().app.getContextObjects();console.log(c),this.hostObjectId=null==c?"urn:vmomi:HostSystem:host-1034:674908e5-ab21-4079-9cb1-596358ee5dd1":c[0].id,this.ipsGetUrlParams.params.hostObjectId=this.hostObjectId,this.configModel.hostObjectId=this.hostObjectId,this.loadIps(),this.loadStorageDevice()}},{key:"loadIps",value:function(){var c=this;this.gs.loading=!0,this.http.get(this.ipsGetUrl,this.ipsGetUrlParams).subscribe((function(t){c.gs.loading=!1,"200"===t.code&&(c.ips=t.data,c.cdr.detectChanges())}),(function(c){console.error("ERROR",c)})),this.cdr.detectChanges()}},{key:"loadStorageDevice",value:function(){var c=this;this.gs.loading=!0,this.http.get(this.storageGetUrl,{}).subscribe((function(t){c.gs.loading=!1,"200"===t.code&&(c.storageDevices=t.data,setTimeout((function(){c.loadPorts()}),1e3),c.cdr.detectChanges())}),(function(c){console.error("ERROR",c)}))}},{key:"loadPorts",value:function(){var c=this;""!==this.configModel.sn&&""!==this.configModel.vmKernel.device&&(this.portLoading=!0,this.portGetUrlParams.params.storageSn=this.configModel.sn,this.http.get(this.portGetUrl,this.portGetUrlParams).subscribe((function(t){"200"===t.code&&(t.data.forEach((function(c){c.connectStatus=""})),c.portList=t.data,c.portTotal=t.data.length,c.cdr.detectChanges(),c.portLoading=!1,c.testPortConnected())}),(function(t){console.error("ERROR",t),c.portLoading=!1})))}},{key:"testPortConnected",value:function(){var c=this,t=new R,e=[];this.portList.forEach((function(c){c.mgmtIp&&""!=c.mgmtIp&&e.push(c)})),t.ethPorts=e,t.hostObjectId=this.configModel.hostObjectId,t.vmKernel=this.configModel.vmKernel,this.http.post(this.testPortConnectedUrl,t).subscribe((function(t){"200"===t.code&&t.data?(t.data.forEach((function(t){c.portList.forEach((function(c){t.id==c.id&&(c.connectStatus=t.connectStatus)}))})),c.cdr.detectChanges()):alert("\u6d4b\u8bd5\u8fde\u901a\u6027\u51fa\u9519")}),(function(c){console.error("ERROR",c)}))}},{key:"submit",value:function(){var c=this;this.isSubmit=!0,this.myForm.form.invalid?this.rdmFormGroup.markAsTouched():0!=this.configModel.ethPorts.length&&(this.gs.loading=!0,this.http.post(this.configIscsiUrl,this.configModel).subscribe((function(t){c.gs.loading=!1,"200"==t.code?c.tipModalSuccess=!0:c.tipModalFail=!0,c.cdr.detectChanges()}),(function(c){console.error("ERROR",c)})),this.cdr.detectChanges())}}])&&t(n.prototype,i),o&&t(n,o),e}()).\u0275fac=function(c){return new(c||P)(b.Ob(b.h),b.Ob(d.b),b.Ob(r.a),b.Ob(a.b))},P.\u0275cmp=b.Ib({type:P,selectors:[["app-iscsi"]],viewQuery:function(c,t){var e;1&c&&(b.Ec(l.A,!0),b.Ec(m,!0)),2&c&&(b.vc(e=b.dc())&&(t.rdmFormGroup=e.first),b.vc(e=b.dc())&&(t.myForm=e.first))},features:[b.Bb([r.a])],decls:97,vars:87,consts:[[2,"margin-left","30px"],["clrForm",""],["myForm","ngForm"],[2,"color","red"],["clrSelect","","required","","name","hostIp",3,"ngModel","change","ngModelOptions","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["clrSelect","","required","","name","storageDeviceId",3,"ngModel","change","ngModelOptions","ngModelChange"],[2,"margin-top","20px"],[2,"margin-top","2%"],[3,"clrDgSelected","clrDgLoading","clrDgSelectedChange"],[3,"clrDgField"],[3,"clrDgItem","clrDgSelectable",4,"clrDgItems","clrDgItemsOf"],[2,"color","#c61d00",3,"hidden"],["type","button",1,"btn","btn-primary",2,"display","block","margin","0 auto",3,"click"],[3,"clrModalOpen","clrModalSize","clrModalOpenChange"],[1,"modal-title"],[1,"modal-body"],["shape","success-standard",1,"is-solid",2,"color","#59A220","margin-right","5px"],[1,"modal-footer"],["type","button",1,"btn","btn-success",3,"click"],["shape","error-standard",1,"is-solid",2,"color","red","margin-right","5px"],["type","button",1,"btn","btn-danger",3,"click"],[3,"value"],[3,"clrDgItem","clrDgSelectable"],[4,"ngIf"],[1,"color-square"],["src","./assets/images/loading.gif","width","20px","height","20px"]],template:function(c,t){1&c&&(b.Ub(0,"div"),b.Ub(1,"div",0),b.Ub(2,"div"),b.Ub(3,"form",1,2),b.Ub(5,"clr-select-container"),b.Ub(6,"label"),b.Kc(7),b.hc(8,"translate"),b.Ub(9,"span",3),b.Kc(10,"*"),b.Tb(),b.Kc(11,":"),b.Tb(),b.Ub(12,"select",4),b.cc("change",(function(){return t.loadPorts()}))("ngModelOptions",(function(){return t.ips}))("ngModelChange",(function(c){return t.configModel.vmKernel.device=c})),b.Ic(13,u,2,3,"option",5),b.Tb(),b.Ub(14,"clr-control-error"),b.Kc(15),b.hc(16,"translate"),b.Tb(),b.Tb(),b.Ub(17,"clr-select-container"),b.Ub(18,"label"),b.Kc(19),b.hc(20,"translate"),b.Ub(21,"span",3),b.Kc(22,"*"),b.Tb(),b.Kc(23,":"),b.Tb(),b.Ub(24,"select",6),b.cc("change",(function(){return t.loadPorts()}))("ngModelOptions",(function(){return t.storageDevices}))("ngModelChange",(function(c){return t.configModel.sn=c})),b.Ic(25,h,2,2,"option",5),b.Tb(),b.Ub(26,"clr-control-error"),b.Kc(27),b.hc(28,"translate"),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Ub(29,"div",7),b.Ub(30,"p",8),b.Kc(31),b.hc(32,"translate"),b.Ub(33,"span",3),b.Kc(34,"*"),b.Tb(),b.Tb(),b.Sb(35),b.Ub(36,"clr-datagrid",9),b.cc("clrDgSelectedChange",(function(c){return t.configModel.ethPorts=c})),b.Ub(37,"clr-dg-column",10),b.Kc(38),b.hc(39,"translate"),b.Tb(),b.Ub(40,"clr-dg-column",10),b.Kc(41),b.hc(42,"translate"),b.Tb(),b.Ub(43,"clr-dg-column",10),b.Kc(44),b.hc(45,"translate"),b.Tb(),b.Ub(46,"clr-dg-column",10),b.Kc(47),b.hc(48,"translate"),b.Tb(),b.Ub(49,"clr-dg-column",10),b.Kc(50),b.hc(51,"translate"),b.Tb(),b.Ub(52,"clr-dg-column",10),b.Kc(53),b.hc(54,"translate"),b.Tb(),b.Ub(55,"clr-dg-column",10),b.Kc(56),b.hc(57,"translate"),b.Tb(),b.Ub(58,"clr-dg-column",10),b.Kc(59),b.hc(60,"translate"),b.Tb(),b.Ub(61,"clr-dg-column",10),b.Kc(62),b.hc(63,"translate"),b.Tb(),b.Ic(64,F,26,18,"clr-dg-row",11),b.Tb(),b.Rb(),b.Ub(65,"p"),b.Ub(66,"span",12),b.Kc(67),b.hc(68,"translate"),b.Tb(),b.Tb(),b.Tb(),b.Ub(69,"div",7),b.Ub(70,"button",13),b.cc("click",(function(){return t.submit()})),b.Kc(71),b.hc(72,"translate"),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Ub(73,"clr-modal",14),b.cc("clrModalOpenChange",(function(c){return t.tipModalSuccess=c})),b.Ub(74,"h3",15),b.Kc(75),b.hc(76,"translate"),b.Tb(),b.Ub(77,"div",16),b.Pb(78,"clr-icon",17),b.Kc(79),b.hc(80,"translate"),b.Tb(),b.Ub(81,"div",18),b.Ub(82,"button",19),b.cc("click",(function(){return t.tipModalSuccess=!1})),b.Kc(83),b.hc(84,"translate"),b.Tb(),b.Tb(),b.Tb(),b.Ub(85,"clr-modal",14),b.cc("clrModalOpenChange",(function(c){return t.tipModalFail=c})),b.Ub(86,"h3",15),b.Kc(87),b.hc(88,"translate"),b.Tb(),b.Ub(89,"div",16),b.Pb(90,"clr-icon",20),b.Kc(91),b.hc(92,"translate"),b.Tb(),b.Ub(93,"div",18),b.Ub(94,"button",21),b.cc("click",(function(){return t.tipModalFail=!1})),b.Kc(95),b.hc(96,"translate"),b.Tb(),b.Tb(),b.Tb()),2&c&&(b.Cb(7),b.Lc(b.ic(8,43,"iscsi.hostIp")),b.Cb(5),b.mc("ngModel",t.configModel.vmKernel.device),b.Cb(1),b.mc("ngForOf",t.ips),b.Cb(2),b.Lc(b.ic(16,45,"validations.required")),b.Cb(4),b.Lc(b.ic(20,47,"iscsi.storage")),b.Cb(5),b.mc("ngModel",t.configModel.sn),b.Cb(1),b.mc("ngForOf",t.storageDevices),b.Cb(2),b.Lc(b.ic(28,49,"validations.required")),b.Cb(4),b.Lc(b.ic(32,51,"iscsi.ports")),b.Cb(5),b.mc("clrDgSelected",t.configModel.ethPorts)("clrDgLoading",t.portLoading),b.Cb(1),b.mc("clrDgField","location"),b.Cb(1),b.Lc(b.ic(39,53,"iscsi.location")),b.Cb(2),b.mc("clrDgField","portName"),b.Cb(1),b.Lc(b.ic(42,55,"iscsi.portName")),b.Cb(2),b.mc("clrDgField","mac"),b.Cb(1),b.Lc(b.ic(45,57,"iscsi.mac")),b.Cb(2),b.mc("clrDgField","maxSpeed"),b.Cb(1),b.Lc(b.ic(48,59,"iscsi.maxSpeed")),b.Cb(2),b.mc("clrDgField","mgmtIp"),b.Cb(1),b.Lc(b.ic(51,61,"iscsi.ip4")),b.Cb(2),b.mc("clrDgField","mgmtIpv6"),b.Cb(1),b.Lc(b.ic(54,63,"iscsi.ip6")),b.Cb(2),b.mc("clrDgField","speed"),b.Cb(1),b.Lc(b.ic(57,65,"iscsi.speed")),b.Cb(2),b.mc("clrDgField","status"),b.Cb(1),b.Lc(b.ic(60,67,"iscsi.hStatus")),b.Cb(2),b.mc("clrDgField","connectStatus"),b.Cb(1),b.Lc(b.ic(63,69,"iscsi.cStatus")),b.Cb(2),b.mc("clrDgItemsOf",t.portList),b.Cb(2),b.mc("hidden",0!=t.configModel.ethPorts.length||!t.isSubmit),b.Cb(1),b.Lc(b.ic(68,71,"iscsi.portNullMessage")),b.Cb(4),b.Lc(b.ic(72,73,"menu.ok")),b.Cb(2),b.mc("clrModalOpen",t.tipModalSuccess)("clrModalSize","sm"),b.Cb(2),b.Lc(b.ic(76,75,"menu.tip")),b.Cb(4),b.Mc("",b.ic(80,77,"bestPractice.exeSuccess")," "),b.Cb(4),b.Lc(b.ic(84,79,"menu.ok")),b.Cb(2),b.mc("clrModalOpen",t.tipModalFail)("clrModalSize","sm"),b.Cb(2),b.Lc(b.ic(88,81,"menu.tip")),b.Cb(4),b.Mc("",b.ic(92,83,"bestPractice.exeFail")," "),b.Cb(4),b.Lc(b.ic(96,85,"menu.ok")))},directives:[g.E,g.r,g.s,l.A,l.V,l.H,g.A,l.U,g.z,g.q,g.t,o.m,l.k,l.m,l.qb,l.sb,l.lb,l.tb,l.o,l.pb,l.r,l.J,l.K,l.B,g.v,g.D,l.v,l.rb,l.n,l.nb,o.n],pipes:[p.c],styles:[".color-square[_ngcontent-%COMP%]{display:inline-block;vertical-align:text-bottom;height:.7rem;width:.7rem;border:.05rem solid #000;border-radius:.2rem}  .clr-select-wrapper select{width:200px}"]}),P),R=function t(){c(this,t)},j=[{path:"",component:x}],G=((k=function t(){c(this,t)}).\u0275mod=b.Mb({type:k}),k.\u0275inj=b.Lb({factory:function(c){return new(c||k)},imports:[[s.i.forChild(j)],s.i]}),k),E=i("M0ag"),q=((w=function t(){c(this,t)}).\u0275mod=b.Mb({type:w}),w.\u0275inj=b.Lb({factory:function(c){return new(c||w)},imports:[[o.c,E.a,G]]}),w)}}])}();