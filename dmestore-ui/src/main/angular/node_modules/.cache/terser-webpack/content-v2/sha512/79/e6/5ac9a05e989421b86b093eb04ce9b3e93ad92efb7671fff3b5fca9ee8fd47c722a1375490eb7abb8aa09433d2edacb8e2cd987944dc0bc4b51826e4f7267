{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{MEKK:function(module,__webpack_exports__,__webpack_require__){\"use strict\";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,\"IscsiModule\",(function(){return iscsi_module_IscsiModule}));var common=__webpack_require__(\"ofXK\"),router=__webpack_require__(\"tyNb\"),common_service=__webpack_require__(\"6rlL\"),globals_service=__webpack_require__(\"/Kh9\"),core=__webpack_require__(\"fXoL\"),http=__webpack_require__(\"tk/3\"),fesm2015_forms=__webpack_require__(\"3Pt+\"),clr_angular=__webpack_require__(\"8MG2\"),ngx_translate_core=__webpack_require__(\"sYmb\");function IscsiComponent_option_10_Template(rf,ctx){if(1&rf&&(core.Ub(0,\"option\",11),core.Kc(1),core.Tb()),2&rf){const item_r3=ctx.$implicit;core.nc(\"value\",item_r3.device),core.Cb(1),core.Nc(\"\",item_r3.ipAddress,\"(\",item_r3.device,\")\")}}function IscsiComponent_option_17_Template(rf,ctx){if(1&rf&&(core.Ub(0,\"option\",11),core.Kc(1),core.Tb()),2&rf){const item_r4=ctx.$implicit;core.nc(\"value\",item_r4.sn),core.Cb(1),core.Lc(item_r4.name)}}function IscsiComponent_clr_dg_row_51_span_6_Template(rf,ctx){1&rf&&(core.Ub(0,\"span\"),core.Kc(1,\"--\"),core.Tb())}function IscsiComponent_clr_dg_row_51_span_7_Template(rf,ctx){if(1&rf&&(core.Ub(0,\"span\"),core.Kc(1),core.Tb()),2&rf){const item_r5=core.gc().$implicit;core.Cb(1),core.Lc(item_r5.mac)}}function IscsiComponent_clr_dg_row_51_span_9_Template(rf,ctx){1&rf&&(core.Ub(0,\"span\"),core.Kc(1,\"--\"),core.Tb())}function IscsiComponent_clr_dg_row_51_span_10_Template(rf,ctx){if(1&rf&&(core.Ub(0,\"span\"),core.Kc(1),core.Tb()),2&rf){const item_r5=core.gc().$implicit;core.Cb(1),core.Lc(item_r5.maxSpeed)}}function IscsiComponent_clr_dg_row_51_span_12_Template(rf,ctx){1&rf&&(core.Ub(0,\"span\"),core.Kc(1,\"--\"),core.Tb())}function IscsiComponent_clr_dg_row_51_span_13_Template(rf,ctx){if(1&rf&&(core.Ub(0,\"span\"),core.Kc(1),core.Tb()),2&rf){const item_r5=core.gc().$implicit;core.Cb(1),core.Lc(item_r5.mgmtIp)}}function IscsiComponent_clr_dg_row_51_span_15_Template(rf,ctx){1&rf&&(core.Ub(0,\"span\"),core.Kc(1,\"--\"),core.Tb())}function IscsiComponent_clr_dg_row_51_span_16_Template(rf,ctx){if(1&rf&&(core.Ub(0,\"span\"),core.Kc(1),core.Tb()),2&rf){const item_r5=core.gc().$implicit;core.Cb(1),core.Lc(item_r5.mgmtIpv6)}}function IscsiComponent_clr_dg_row_51_span_18_Template(rf,ctx){1&rf&&(core.Ub(0,\"span\"),core.Kc(1,\"--\"),core.Tb())}function IscsiComponent_clr_dg_row_51_span_19_Template(rf,ctx){if(1&rf&&(core.Ub(0,\"span\"),core.Kc(1),core.Tb()),2&rf){const item_r5=core.gc().$implicit;core.Cb(1),core.Lc(item_r5.speed)}}function IscsiComponent_clr_dg_row_51_span_23_Template(rf,ctx){1&rf&&(core.Ub(0,\"span\"),core.Pb(1,\"span\",14),core.Tb()),2&rf&&(core.Cb(1),core.Fc(\"background-color\",\"green\"))}function IscsiComponent_clr_dg_row_51_span_24_Template(rf,ctx){1&rf&&(core.Ub(0,\"span\"),core.Pb(1,\"span\",14),core.Tb()),2&rf&&(core.Cb(1),core.Fc(\"background-color\",\"red\"))}function IscsiComponent_clr_dg_row_51_Template(rf,ctx){if(1&rf&&(core.Ub(0,\"clr-dg-row\",12),core.Ub(1,\"clr-dg-cell\"),core.Kc(2),core.Tb(),core.Ub(3,\"clr-dg-cell\"),core.Kc(4),core.Tb(),core.Ub(5,\"clr-dg-cell\"),core.Ic(6,IscsiComponent_clr_dg_row_51_span_6_Template,2,0,\"span\",13),core.Ic(7,IscsiComponent_clr_dg_row_51_span_7_Template,2,1,\"span\",13),core.Tb(),core.Ub(8,\"clr-dg-cell\"),core.Ic(9,IscsiComponent_clr_dg_row_51_span_9_Template,2,0,\"span\",13),core.Ic(10,IscsiComponent_clr_dg_row_51_span_10_Template,2,1,\"span\",13),core.Tb(),core.Ub(11,\"clr-dg-cell\"),core.Ic(12,IscsiComponent_clr_dg_row_51_span_12_Template,2,0,\"span\",13),core.Ic(13,IscsiComponent_clr_dg_row_51_span_13_Template,2,1,\"span\",13),core.Tb(),core.Ub(14,\"clr-dg-cell\"),core.Ic(15,IscsiComponent_clr_dg_row_51_span_15_Template,2,0,\"span\",13),core.Ic(16,IscsiComponent_clr_dg_row_51_span_16_Template,2,1,\"span\",13),core.Tb(),core.Ub(17,\"clr-dg-cell\"),core.Ic(18,IscsiComponent_clr_dg_row_51_span_18_Template,2,0,\"span\",13),core.Ic(19,IscsiComponent_clr_dg_row_51_span_19_Template,2,1,\"span\",13),core.Tb(),core.Ub(20,\"clr-dg-cell\"),core.Kc(21),core.Tb(),core.Ub(22,\"clr-dg-cell\"),core.Ic(23,IscsiComponent_clr_dg_row_51_span_23_Template,2,2,\"span\",13),core.Ic(24,IscsiComponent_clr_dg_row_51_span_24_Template,2,2,\"span\",13),core.Tb(),core.Tb()),2&rf){const item_r5=ctx.$implicit;core.mc(\"clrDgSelectable\",\"true\"==item_r5.connectStatus)(\"clrDgItem\",item_r5),core.Cb(2),core.Lc(item_r5.location),core.Cb(2),core.Lc(item_r5.portName),core.Cb(2),core.mc(\"ngIf\",\"\"==item_r5.mac),core.Cb(1),core.mc(\"ngIf\",\"\"!=item_r5.mac),core.Cb(2),core.mc(\"ngIf\",-1==item_r5.maxSpeed),core.Cb(1),core.mc(\"ngIf\",-1!=item_r5.maxSpeed),core.Cb(2),core.mc(\"ngIf\",\"\"==item_r5.mgmtIp),core.Cb(1),core.mc(\"ngIf\",\"\"!=item_r5.mgmtIp),core.Cb(2),core.mc(\"ngIf\",\"\"==item_r5.mgmtIpv6),core.Cb(1),core.mc(\"ngIf\",\"\"!=item_r5.mgmtIpv6),core.Cb(2),core.mc(\"ngIf\",-1==item_r5.speed),core.Cb(1),core.mc(\"ngIf\",-1!=item_r5.speed),core.Cb(2),core.Lc(item_r5.status),core.Cb(2),core.mc(\"ngIf\",\"true\"==item_r5.connectStatus),core.Cb(1),core.mc(\"ngIf\",\"false\"==item_r5.connectStatus||\"\"==item_r5.mgmtIp||null==item_r5.mgmtIp)}}let iscsi_component_IscsiComponent=(()=>{class IscsiComponent{constructor(cdr,http,commonService,gs){this.cdr=cdr,this.http=http,this.commonService=commonService,this.gs=gs,this.testPortConnectedUrl=\"accesshost/testconnectivity\",this.portGetUrl=\"dmestorage/getstorageethports\",this.portGetUrlParams={params:{storageSn:\"\"}},this.ipsGetUrl=\"accessvmware/getvmkernelipbyhostobjectid\",this.ipsGetUrlParams={params:{hostObjectId:\"\"}},this.storageGetUrl=\"dmestorage/storages\",this.configIscsiUrl=\"accesshost/configureiscsi\",this.storageDevices=[],this.ips=[],this.configModel={hostObjectId:\"\",vmKernel:{device:\"\"},ethPorts:[],sn:\"\"},this.hostObjectId=\"\",this.portLoading=!1,this.portList=[],this.portTotal=0}ngOnInit(){}ngAfterViewInit(){const ctx=this.gs.getClientSdk().app.getContextObjects();console.log(ctx),this.hostObjectId=null==ctx?\"urn:vmomi:HostSystem:host-1034:674908e5-ab21-4079-9cb1-596358ee5dd1\":ctx[0].id,this.ipsGetUrlParams.params.hostObjectId=this.hostObjectId,this.configModel.hostObjectId=this.hostObjectId,this.loadIps(),this.loadStorageDevice()}loadIps(){this.http.get(this.ipsGetUrl,this.ipsGetUrlParams).subscribe(result=>{\"0\"!==result.code&&\"200\"!==result.code||(this.ips=result.data,this.cdr.detectChanges())},err=>{console.error(\"ERROR\",err)})}loadStorageDevice(){this.http.get(this.storageGetUrl,{}).subscribe(result=>{\"200\"===result.code&&(this.storageDevices=result.data.data,setTimeout(()=>{this.loadPorts()},1e3),this.cdr.detectChanges())},err=>{console.error(\"ERROR\",err)})}loadPorts(){\"\"!==this.configModel.sn&&\"\"!==this.configModel.vmKernel.device&&(this.portLoading=!0,this.portGetUrlParams.params.storageSn=this.configModel.sn,this.http.get(this.portGetUrl,this.portGetUrlParams).subscribe(result=>{\"0\"!==result.code&&\"200\"!==result.code||(result.data.forEach(item=>{item.connectStatus=\"\"}),this.portList=result.data,this.portTotal=result.data.length,this.cdr.detectChanges(),this.portLoading=!1,this.testPortConnected())},err=>{console.error(\"ERROR\",err),this.portLoading=!1}))}testPortConnected(){const p=new testConnectParams,testPortList=[];this.portList.forEach(item=>{item.mgmtIp&&\"\"!=item.mgmtIp&&testPortList.push(item)}),p.ethPorts=testPortList,p.hostObjectId=this.configModel.hostObjectId,p.vmKernel=this.configModel.vmKernel,this.http.post(this.testPortConnectedUrl,p).subscribe(result=>{\"200\"===result.code&&result.data?(result.data.forEach(i=>{this.portList.forEach(j=>{i.id==j.id&&(j.connectStatus=i.connectStatus)})}),this.cdr.detectChanges()):alert(\"测试连通性出错\")},err=>{console.error(\"ERROR\",err)})}submit(){console.log(this.configModel),this.http.post(this.configIscsiUrl,this.configModel).subscribe(result=>{},err=>{console.error(\"ERROR\",err)})}}return IscsiComponent.ɵfac=function(t){return new(t||IscsiComponent)(core.Ob(core.h),core.Ob(http.b),core.Ob(common_service.a),core.Ob(globals_service.b))},IscsiComponent.ɵcmp=core.Ib({type:IscsiComponent,selectors:[[\"app-iscsi\"]],features:[core.Bb([common_service.a,globals_service.b])],decls:56,vars:55,consts:[[2,\"margin-left\",\"30px\"],[\"clrForm\",\"\"],[\"clrSelect\",\"\",\"name\",\"hostIp\",3,\"ngModel\",\"change\",\"ngModelOptions\",\"ngModelChange\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[\"clrSelect\",\"\",\"name\",\"storageDeviceId\",3,\"ngModel\",\"change\",\"ngModelOptions\",\"ngModelChange\"],[2,\"margin-top\",\"20px\"],[2,\"margin-top\",\"2%\"],[3,\"clrDgSelected\",\"clrDgLoading\",\"clrDgSelectedChange\"],[3,\"clrDgField\"],[3,\"clrDgSelectable\",\"clrDgItem\",4,\"clrDgItems\",\"clrDgItemsOf\"],[\"type\",\"button\",1,\"btn\",\"btn-primary\",2,\"display\",\"block\",\"margin\",\"0 auto\",3,\"click\"],[3,\"value\"],[3,\"clrDgSelectable\",\"clrDgItem\"],[4,\"ngIf\"],[1,\"color-square\"]],template:function(rf,ctx){1&rf&&(core.Ub(0,\"div\"),core.Ub(1,\"div\",0),core.Ub(2,\"div\"),core.Ub(3,\"form\",1),core.Ub(4,\"clr-select-container\"),core.Ub(5,\"label\"),core.Kc(6),core.hc(7,\"translate\"),core.Tb(),core.Kc(8,\": \"),core.Ub(9,\"select\",2),core.cc(\"change\",(function(){return ctx.loadPorts()}))(\"ngModelOptions\",(function(){return ctx.ips}))(\"ngModelChange\",(function($event){return ctx.configModel.vmKernel.device=$event})),core.Ic(10,IscsiComponent_option_10_Template,2,3,\"option\",3),core.Tb(),core.Tb(),core.Ub(11,\"clr-select-container\"),core.Ub(12,\"label\"),core.Kc(13),core.hc(14,\"translate\"),core.Tb(),core.Kc(15,\": \"),core.Ub(16,\"select\",4),core.cc(\"change\",(function(){return ctx.loadPorts()}))(\"ngModelOptions\",(function(){return ctx.storageDevices}))(\"ngModelChange\",(function($event){return ctx.configModel.sn=$event})),core.Ic(17,IscsiComponent_option_17_Template,2,2,\"option\",3),core.Tb(),core.Tb(),core.Tb(),core.Tb(),core.Ub(18,\"div\",5),core.Ub(19,\"p\",6),core.Kc(20),core.hc(21,\"translate\"),core.Tb(),core.Sb(22),core.Ub(23,\"clr-datagrid\",7),core.cc(\"clrDgSelectedChange\",(function($event){return ctx.configModel.ethPorts=$event})),core.Ub(24,\"clr-dg-column\",8),core.Kc(25),core.hc(26,\"translate\"),core.Tb(),core.Ub(27,\"clr-dg-column\",8),core.Kc(28),core.hc(29,\"translate\"),core.Tb(),core.Ub(30,\"clr-dg-column\",8),core.Kc(31),core.hc(32,\"translate\"),core.Tb(),core.Ub(33,\"clr-dg-column\",8),core.Kc(34),core.hc(35,\"translate\"),core.Tb(),core.Ub(36,\"clr-dg-column\",8),core.Kc(37),core.hc(38,\"translate\"),core.Tb(),core.Ub(39,\"clr-dg-column\",8),core.Kc(40),core.hc(41,\"translate\"),core.Tb(),core.Ub(42,\"clr-dg-column\",8),core.Kc(43),core.hc(44,\"translate\"),core.Tb(),core.Ub(45,\"clr-dg-column\",8),core.Kc(46),core.hc(47,\"translate\"),core.Tb(),core.Ub(48,\"clr-dg-column\",8),core.Kc(49),core.hc(50,\"translate\"),core.Tb(),core.Ic(51,IscsiComponent_clr_dg_row_51_Template,25,17,\"clr-dg-row\",9),core.Tb(),core.Rb(),core.Tb(),core.Ub(52,\"div\",5),core.Ub(53,\"button\",10),core.cc(\"click\",(function(){return ctx.submit()})),core.Kc(54),core.hc(55,\"translate\"),core.Tb(),core.Tb(),core.Tb(),core.Tb()),2&rf&&(core.Cb(6),core.Lc(core.ic(7,29,\"iscsi.hostIp\")),core.Cb(3),core.mc(\"ngModel\",ctx.configModel.vmKernel.device),core.Cb(1),core.mc(\"ngForOf\",ctx.ips),core.Cb(3),core.Lc(core.ic(14,31,\"iscsi.storage\")),core.Cb(3),core.mc(\"ngModel\",ctx.configModel.sn),core.Cb(1),core.mc(\"ngForOf\",ctx.storageDevices),core.Cb(3),core.Lc(core.ic(21,33,\"iscsi.ports\")),core.Cb(3),core.mc(\"clrDgSelected\",ctx.configModel.ethPorts)(\"clrDgLoading\",ctx.portLoading),core.Cb(1),core.mc(\"clrDgField\",\"location\"),core.Cb(1),core.Lc(core.ic(26,35,\"iscsi.location\")),core.Cb(2),core.mc(\"clrDgField\",\"portName\"),core.Cb(1),core.Lc(core.ic(29,37,\"iscsi.portName\")),core.Cb(2),core.mc(\"clrDgField\",\"mac\"),core.Cb(1),core.Lc(core.ic(32,39,\"iscsi.mac\")),core.Cb(2),core.mc(\"clrDgField\",\"maxSpeed\"),core.Cb(1),core.Lc(core.ic(35,41,\"iscsi.maxSpeed\")),core.Cb(2),core.mc(\"clrDgField\",\"mgmtIp\"),core.Cb(1),core.Lc(core.ic(38,43,\"iscsi.ip4\")),core.Cb(2),core.mc(\"clrDgField\",\"mgmtIpv6\"),core.Cb(1),core.Lc(core.ic(41,45,\"iscsi.ip6\")),core.Cb(2),core.mc(\"clrDgField\",\"speed\"),core.Cb(1),core.Lc(core.ic(44,47,\"iscsi.speed\")),core.Cb(2),core.mc(\"clrDgField\",\"status\"),core.Cb(1),core.Lc(core.ic(47,49,\"iscsi.hStatus\")),core.Cb(2),core.mc(\"clrDgField\",\"connectStatus\"),core.Cb(1),core.Lc(core.ic(50,51,\"iscsi.cStatus\")),core.Cb(2),core.mc(\"clrDgItemsOf\",ctx.portList),core.Cb(3),core.Lc(core.ic(55,53,\"menu.ok\")))},directives:[fesm2015_forms.E,fesm2015_forms.r,fesm2015_forms.s,clr_angular.A,clr_angular.W,clr_angular.H,fesm2015_forms.A,clr_angular.V,fesm2015_forms.q,fesm2015_forms.t,common.m,clr_angular.m,clr_angular.qb,clr_angular.sb,clr_angular.lb,clr_angular.tb,clr_angular.o,clr_angular.pb,clr_angular.r,fesm2015_forms.v,fesm2015_forms.D,clr_angular.v,clr_angular.rb,clr_angular.n,clr_angular.nb,common.n],pipes:[ngx_translate_core.c],styles:[\".modal-dialog.modal-lg{width:1280px}.color-square[_ngcontent-%COMP%]{display:inline-block;vertical-align:text-bottom;height:.7rem;width:.7rem;border:.05rem solid #000;border-radius:.2rem}\"]}),IscsiComponent})();class testConnectParams{}const routes=[{path:\"\",component:iscsi_component_IscsiComponent}];let iscsi_routing_module_IscsiRoutingModule=(()=>{class IscsiRoutingModule{}return IscsiRoutingModule.ɵmod=core.Mb({type:IscsiRoutingModule}),IscsiRoutingModule.ɵinj=core.Lb({factory:function(t){return new(t||IscsiRoutingModule)},imports:[[router.i.forChild(routes)],router.i]}),IscsiRoutingModule})();var shared=__webpack_require__(\"M0ag\");let iscsi_module_IscsiModule=(()=>{class IscsiModule{}return IscsiModule.ɵmod=core.Mb({type:IscsiModule}),IscsiModule.ɵinj=core.Lb({factory:function(t){return new(t||IscsiModule)},imports:[[common.c,shared.a,iscsi_routing_module_IscsiRoutingModule]]}),IscsiModule})()}}]);","extractedComments":[]}