<div class="clr-row">
  <clr-datagrid style="width: 700px">

    <clr-dg-column>{{'rdm.name' | translate}}<span style="color: red">*</span></clr-dg-column>
    <clr-dg-column>{{'rdm.capacity' | translate}}<span style="color: red">*</span></clr-dg-column>
    <clr-dg-column>{{'rdm.count' | translate}}<span style="color: red">*</span></clr-dg-column>
    <clr-dg-column>{{'rdm.operation' | translate}}</clr-dg-column>

    <clr-dg-row *ngFor="let item of configModel.volume_specs" [clrDgItem]="item">
      <clr-dg-cell style="width: 200px">
        <input type="text" required [(ngModel)]="item.name" #name="ngModel" name="name" style="height: 30px"/>
        <!--<div [hidden]="item.name!==''">*爱好为必填项</div>-->
      </clr-dg-cell>
      <clr-dg-cell style="width: 200px">
        <input type="number" [(ngModel)]="item.capacity" name="capacity" #number="ngModel" style="height: 30px;width: 100px"/>
        <select [(ngModel)]="item.unit" name="unit" style="height: 30px">
          <option value="GB">GB</option>
          <option value="TB">TB</option>
        </select>
      </clr-dg-cell>
      <clr-dg-cell style="width: 200px">
        <input type="number" [(ngModel)]="item.count" name="count" #number="ngModel" style="height: 30px"/>
      </clr-dg-cell>
      <clr-dg-cell [hidden]="configModel.volume_specs.length===1" style="width: 100px">
        <span (click)="basRemove(item)" style="color:#00F;cursor:pointer">{{'rdm.remove' | translate}}</span>
      </clr-dg-cell>
      <clr-dg-cell [hidden]="configModel.volume_specs.length!==1" style="width: 100px">
      </clr-dg-cell>
    </clr-dg-row>
  </clr-datagrid>
</div>
<form clrForm #rdmForm="ngForm">
  <div class="clr-row">
    <span (click)="basAdd()" style="margin-top: 20px;margin-left: 20px;color:#00F;cursor:pointer">{{'rdm.add' | translate}}</span>
  </div>
  <div class="clr-row">
    <clr-select-container>
      <label>{{'rdm.host' | translate}}<span style="color: red">*</span></label>
      <select clrSelect (ngModelOptions)="hostList" [(ngModel)]="hostSelected" required name="hostSelected" class="clr-select" (change)="loadDataStore(hostSelected)">
        <option *ngFor="let item of hostList" value="{{item.id}}">{{item.ip}}({{item.name}})</option>
      </select>
      <clr-control-error>{{'validations.required' | translate}}</clr-control-error>
    </clr-select-container>
    <clr-select-container>
      <label>{{'rdm.dataStore' | translate}}<span style="color: red">*</span></label>
      <select clrSelect (ngModelOptions)="dataStores" required [(ngModel)]="dataStoreName" name="dataStoreName" class="clr-select">
        <option *ngFor="let item of dataStores" value="{{item.name}}">{{item.name}}</option>
      </select>
      <clr-control-error>{{'validations.required' | translate}}</clr-control-error>
    </clr-select-container>

    <!-- 选择 服务等级 存储选-->
    <clr-radio-container clrInline>
      <label>{{'rdm.storageType' | translate}}</label>
      <clr-radio-wrapper>
        <input type="radio" clrRadio (click)="levelCheck='level'" name="storageType"  value="1" [(ngModel)]="configModel.storageType" />
        <label>{{'rdm.tier' | translate}}</label>
      </clr-radio-wrapper>
      <clr-radio-wrapper>
        <input type="radio" clrRadio  (click)="levelCheck='storage'" name="storageType"  value="2" [(ngModel)]="configModel.storageType" />
        <label>{{'rdm.storage1' | translate}}</label>
      </clr-radio-wrapper>
      <!--<clr-control-helper>Helper text</clr-control-helper>
      <clr-control-error>This field is required!</clr-control-error>-->
    </clr-radio-container>
  </div>

  <div class="clr-row">
    <!-- 服务等级-->
    <!-- 1、选择 服务等级-->
    <div *ngIf="levelCheck==='level'" [hidden]="levelCheck !=='level'">
      <clr-accordion>
        <clr-accordion-panel (click)="serviceLevelClick(item.id, item.name);" *ngFor="let item of serviceLevels;" style="margin-top: 20px;" >
          <clr-accordion-title style="height: 50px; line-height: 50px;color: #333;font-size:16px;">{{item.name}}</clr-accordion-title>
          <clr-accordion-content>
            <table class="table table-vertical table-noborder table-compact">
              <tbody>
              <tr>
                <th hidden></th>
                <th>
                  {{item.name}}
                </th>
              </tr>
              <tr>
                <th hidden></th>
                <td>{{'vmfs.capacityUsage' | translate}}</td>
                <td>{{'vmfs.qos' | translate}}</td>
              </tr>
              <tr>
                <th hidden></th>
                <th><clr-progress-bar clrValue="{{item.usedRate}}" clrSuccess clrLabeled></clr-progress-bar></th>
                <th *ngIf="item.capabilities.qos != undefined && item.capabilities.qos.qosParam.maxIOPS != undefined">
                  IOPS <= {{item.capabilities.qos.qosParam.maxIOPS}} IOPS/TB
                </th>
                <th *ngIf="item.capabilities.qos != undefined && item.capabilities.qos.qosParam.minIOPS != undefined">
                  IOPS >= {{item.capabilities.qos.qosParam.minIOPS}} IOPS/TB
                </th>
              </tr>
              <tr>
                <th hidden></th>
                <th></th>
                <th *ngIf="item.capabilities.qos != undefined
                                            && item.capabilities.qos.enabled == true
                                            && item.capabilities.qos.qosParam.minBandWidth != undefined">
                  {{'tier.bandwidth'|translate}} >= {{item.capabilities.qos.qosParam.minBandWidth}} Mbps/s
                </th>
                <th *ngIf="item.capabilities.qos != undefined
                                            && item.capabilities.qos.enabled == true
                                            && item.capabilities.qos.qosParam.maxBandWidth != undefined">
                  {{'tier.bandwidth'|translate}} <= {{item.capabilities.qos.qosParam.maxBandWidth}} Mbps/s
                </th>
              </tr>
              <tr>
                <th hidden></th>
                <th>{{item.used_capacity}} GB/{{item.total_capacity}}GB</th>
                <th *ngIf="item.capabilities.qos != undefined
                                            && item.capabilities.qos.enabled == true
                                            && item.capabilities.qos.qosParam.latency != undefined">
                  Latency= {{item.capabilities.qos.qosParam.latency}} {{item.capabilities.qos.qosParam.latencyUnit}}
                </th>
              </tr>
              </tbody>
            </table>
          </clr-accordion-content>
          <img src="./assets/images/selectDown.svg" style="position: absolute;right: 0px;bottom: 0px;" width="40px" height="40px">
        </clr-accordion-panel>
      </clr-accordion>
    </div>

    <!-- 选择存储 -->
    <div *ngIf="levelCheck==='storage'" [hidden]="levelCheck !=='storage'">
      <clr-select-container>
        <label>{{'rdm.storage' | translate}}<span style="color: red">*</span></label>:
        <select clrSelect  [(ngModel)]="configModel.storage_id" name="storage_id" required (ngModelChange)="loadStoragePool(configModel.storage_id);">
          <option value=""></option>
          <option *ngFor="let item of storageDevices" value="{{item.id}}">{{item.name}}</option>
        </select>
        <clr-control-error>{{'validations.required' | translate}}</clr-control-error>
      </clr-select-container>
      <clr-select-container>
        <label>{{'rdm.sPool' | translate}}<span style="color: red">*</span></label>:
        <select clrSelect [(ngModel)]="configModel.pool_raw_id" name="pool_raw_id" required>
          <option value=""></option>
          <option *ngFor="let item of storagePools" value="{{item.storage_pool_id}}">{{item.name}}</option>
        </select>
        <clr-control-error>{{'validations.required' | translate}}</clr-control-error>
      </clr-select-container>
      <!--<clr-combobox-container>
        <label>{{'rdm.host' | translate}}<span style="color: red">*</span></label>
        <clr-combobox (change)="loadDataStore(hostSelected.id)" [(ngModel)]="hostSelected" name="host_id">
          <clr-options>
            <clr-option *clrOptionItems="let item of hostList;field:'name'" [clrValue]="item">
              {{item.ip}}({{item.name}})
            </clr-option>
          </clr-options>
        </clr-combobox>
      </clr-combobox-container>

      <clr-combobox-container>
        <label>{{'rdm.dataStore' | translate}}<span style="color: red">*</span></label>
        <clr-combobox [(ngModel)]="data_store_name" name="data_store_name">
          <clr-options>
            <clr-option *clrOptionItems="let item of dataStores;field:'name'" [clrValue]="item">
              {{item.name}}
            </clr-option>
          </clr-options>
        </clr-combobox>
      </clr-combobox-container>-->

      <clr-select-container>
        <label>{{'rdm.ownerC' | translate}}<span style="color: red">*</span></label>:
        <select clrSelect [(ngModel)]="configModel.owner_controller" name="owner_controller" required>
          <option value="0">{{'rdm.autoSelect' | translate}}</option>
          <option value="1">0A</option>
          <option value="2">0B</option>
        </select>
        <clr-control-error>{{'validations.required' | translate}}</clr-control-error>
      </clr-select-container>

      <clr-select-container>
        <label>{{'rdm.idp' | translate}}<span style="color: red">*</span></label>:
        <select clrSelect [(ngModel)]="configModel.initial_distribute_policy" name="initial_distribute_policy" required>
          <option value="0">{{'rdm.autoSelect' | translate}}</option>
          <option value="1">{{'rdm.hperformanceLevel' | translate}}</option>
          <option value="2">{{'rdm.performanceLevel' | translate}}</option>
          <option value="3">{{'rdm.capacityLevel' | translate}}</option>
        </select>
        <clr-control-error>{{'validations.required' | translate}}</clr-control-error>
      </clr-select-container>

      <clr-select-container>
        <label>{{'rdm.fetchP' | translate}}<span style="color: red">*</span></label>:
        <select clrSelect [(ngModel)]="configModel.prefetch_policy" name="prefetch_policy" required>
          <option value="0">{{'rdm.notFetch' | translate}}</option>
          <option value="1">{{'rdm.fixedFetch' | translate}}</option>
          <option value="2">{{'rdm.variableFetch' | translate}}</option>
          <option value="3">{{'rdm.smartFetch' | translate}}</option>
        </select>
        <clr-control-error>{{'validations.required' | translate}}</clr-control-error>
      </clr-select-container>

      <!-- 调优 -->
      <clr-input-container>
        <label>{{'rdm.tuning' | translate}}</label>
      </clr-input-container>



      <!-- smartTier -->
      <clr-toggle-container>
        <clr-toggle-wrapper>
          <label>{{'rdm.smartTier' | translate}}</label>
          <input type="checkbox" clrToggle [(ngModel)]="policyEnable.smartTier" name="options" />
        </clr-toggle-wrapper>
      </clr-toggle-container>

      <clr-select-container *ngIf="policyEnable.smartTier">
        <label>{{'rdm.smartTierP' | translate}}<span style="color: red">*</span></label>:
        <select clrSelect [(ngModel)]="configModel.tuning.smarttier" name="smarttier">
          <option value="0">{{'rdm.notMove' | translate}}</option>
          <option value="1">{{'rdm.autoMove' | translate}}</option>
          <option value="2">{{'rdm.highPMove' | translate}}</option>
          <option value="3">{{'rdm.lowPMove' | translate}}</option>
        </select>
      </clr-select-container>


      <!-- Qos Policy -->
      <clr-toggle-container>
        <clr-toggle-wrapper>
          <label>{{'rdm.qosP' | translate}}</label>
          <input type="checkbox" clrToggle  [(ngModel)]="policyEnable.qosPolicy" name="options" />
        </clr-toggle-wrapper>
      </clr-toggle-container>

      <clr-radio-container clrInline *ngIf="policyEnable.qosPolicy">
        <label class="floatleft">{{'rdm.controlP' | translate}}<span style="color: red">*</span></label>
        <clr-radio-wrapper>
          <input type="radio" clrRadio name="control_policy" required value="1" [(ngModel)]="configModel.tuning.smartqos.control_policy" />
          <label>{{'rdm.uLimit' | translate}}</label>
        </clr-radio-wrapper>
        <clr-radio-wrapper>
          <input type="radio" clrRadio name="control_policy" required value="0" [(ngModel)]="configModel.tuning.smartqos.control_policy" />
          <label>{{'rdm.lLimit' | translate}}</label>
        </clr-radio-wrapper>
      </clr-radio-container>

      <div *ngIf="policyEnable.qosPolicy">
        <clr-checkbox-container *ngIf="configModel.tuning.smartqos.control_policy==='1'">
          <label>{{'rdm.trafficC' | translate}}<span style="color: red">*</span></label>
          <clr-checkbox-wrapper>
            <input type="checkbox" clrCheckbox/>
            <label>{{'rdm.bandwidth' | translate}} <= <input class="inputOneLine" name="Brandwidth" [(ngModel)]="configModel.tuning.smartqos.maxbandwidth"/> MB/s
            </label>
          </clr-checkbox-wrapper>
          <clr-checkbox-wrapper>
            <input type="checkbox" clrCheckbox/>
            <label>IOPS <= <input class="inputOneLine" name="IOPS" [(ngModel)]="configModel.tuning.smartqos.maxiops"/>
            </label>
          </clr-checkbox-wrapper>
        </clr-checkbox-container>

        <clr-checkbox-container *ngIf="configModel.tuning.smartqos.control_policy==='0'">
          <label>{{'rdm.trafficC' | translate}}<span style="color: red">*</span></label>
          <clr-checkbox-wrapper>
            <input type="checkbox" clrCheckbox/>
            <label>{{'rdm.bandwidth' | translate}} >= <input class="inputOneLine" name="Brandwidth" [(ngModel)]="configModel.tuning.smartqos.minbandwidth"/> MB/s
            </label>
          </clr-checkbox-wrapper>
          <clr-checkbox-wrapper>
            <input type="checkbox" clrCheckbox/>
            <label>IOPS >= <input class="inputOneLine" name="IOPS" [(ngModel)]="configModel.tuning.smartqos.miniops"/>
            </label>
          </clr-checkbox-wrapper>
          <clr-checkbox-wrapper>
            <input type="checkbox" clrCheckbox/>
            <label>{{'rdm.latency' | translate}} <= <input class="inputOneLine" name="Latency" [(ngModel)]="configModel.tuning.smartqos.latency"/> ms
            </label>
          </clr-checkbox-wrapper>
        </clr-checkbox-container>

      </div>

      <!-- Resource Tuning -->
      <clr-toggle-container>
        <clr-toggle-wrapper>
          <label>{{'rdm.rtuning' | translate}}</label>
          <input type="checkbox" clrToggle [(ngModel)]="policyEnable.resourceTuning" name="options" />
        </clr-toggle-wrapper>
      </clr-toggle-container>

      <clr-select-container *ngIf="policyEnable.resourceTuning">
        <label>{{'rdm.alloctype' | translate}}<span style="color: red">*</span></label>:
        <select clrSelect [(ngModel)]="configModel.tuning.alloctype" name="alloctype" >
          <option value="thin">thin</option>
          <option value="thick">thick</option>
        </select>
      </clr-select-container>

      <clr-select-container *ngIf="configModel.tuning.alloctype == 'thin' && policyEnable.resourceTuning">
        <label>{{'rdm.dedupe' | translate}}<span style="color: red">*</span></label>:
        <select clrSelect [(ngModel)]="configModel.tuning.dedupe_enabled" name="dedupe" >
          <option value=null>{{'rdm.default' | translate}}</option>
          <option value=true>{{'rdm.enable' | translate}}</option>
          <option value=false>{{'rdm.disable' | translate}}</option>
        </select>
      </clr-select-container>

      <clr-select-container *ngIf="configModel.tuning.alloctype == 'thin' && policyEnable.resourceTuning">
        <label>{{'rdm.compression' | translate}}<span style="color: red">*</span></label>:
        <select clrSelect [(ngModel)]="configModel.tuning.compression_enabled" name="compression" >
          <option value=null>{{'rdm.default' | translate}}</option>
          <option value=true>{{'rdm.enable' | translate}}</option>
          <option value=false>{{'rdm.disable' | translate}}</option>
        </select>
      </clr-select-container>
    </div>
  </div>
  <div class="clr-row">
    <div class="clr-col-2"></div>
    <div class="clr-col-4">
      <button type="button" class="btn btn-primary" (click)="submit()">{{'menu.submit' | translate}}</button>
    </div>
  </div>
</form>
